function Actor(e,t){this.x=this.prev_x=0,this.y=this.prev_y=0,this.hitbox=e,this.sprite=new Sprite(t),this.x_velocity=0,this.y_velocity=0,this.prev_frame=null,this.timer=null,this.timer_callback=null}function Animation(e,t,i){this.name=e,this.frames=t,this.max_frames=t.length,this.continuous=i}function BackgroundImage(e){this.file_name="backgrounds/"+e,this.image=new Image,this.image.onload=function(){this.loaded=!0},this.image.src=this.file_name,this.x_parallax=0,this.y_parallax=0}function BackgroundImageMap(){this.backgrounds={}}function CollisionSides(){this.collisions={1:!1,"-1":!1,2:!1,"-2":!1}}function Effect(e,t,i){this.x=e,this.y=t,this.total_time=i,this.time=0,this.removed=!1}function SpriteEffect(e,t,i,r){this.constructor(e,t),this.sprite=new Sprite(sprite_name),this.sprite.init(r)}function Frame(e,t,i,r){this.rect=e,this.duration=t,this.hitbox=i,this.callback=r}function Game(e){this.game_phase_map=new GamePhaseMap,this.tile_map=new TileSetMap,this.sprite_sheet_map=new SpriteSheetMap,this.background_image_map=new BackgroundImageMap,this.game_state=new GameState,this.game_engine=new GameEngine,this.sound_map=new SoundMap,this.preloader_class_name=e,this.current_phase=null,this.current_phase_name=null,this.new_phase_name=null}function GameEngine(){this.frame_rate=60,this.prev_time=0,this.width=0,this.height=0,this.preloader={},this.key_handler={},this.fonts_loaded=!1,this.audio_context=null}function GamePhase(e){this.transitions=e}function GamePhaseMap(){this.phases=new Object}function KeyHandler(){this.continuous_key_codes=new Array,this.pressed_key_codes=new Array}function Level(e,t,i){this.object_initializer=e,this.geometry_initializer=t,this.background_image_name=i}function Preloader(e,t){this.width=e,this.height=t,this.items=new Array}function Rectangle(e,t,i,r){this.x=e,this.y=t,this.width=i,this.height=r}function SoundMap(){this.sounds={}}function Sound(e,t){this.file_name=e,this.loaded=!1,this.buffer=null,this.looping=t,this.load()}function Sprite(e){this.width_scaling=1,this.height_scaling=1,this.sprite_name=e,this.callback=null}function SpriteSheet(e,t,i){this.file_name="sprites/"+e,this.tile_width=t,this.tile_height=i,this.animations=[],this.image=new Image,this.image.onload=function(){this.loaded=!0},this.image.src=this.file_name}function SpriteSheetMap(){this.sprite_sheets={}}function TileGeometry(e,t,i){this.tile_size=e,this.tiles_wide=0,this.tiles_high=0,this._processString(t),this.tile_set=game.tile_map.getTileSet(i)}function LevelTile(e,t,i,r,a){this.constructor(new Rectangle(0,0,i,i),null),this.init(e,t,"null"),this.id=r;var s=a.getTileType(r);null!=s&&(this.attributes=s.attributes,this.shape=s.shape)}function TileSet(e,t){this.file_name="tiles/"+e,this.tiles={},this.tile_size=t,this.image=new Image,this.image.onload=function(){this.loaded=!0},this.image.src=this.file_name}function TileSetMap(){this.tile_sets={}}function UIElement(){}function SpriteRepeaterUIElement(e,t){this.padding=t,this.sprite=new Sprite(e),this.sprite.init(),this.sprite_width=this.sprite.sprite_sheet.tile_width,this.sprite_height=this.sprite.sprite_sheet.tile_height}function MeterUIElement(e,t,i,r){this.width=e,this.height=t,this.color=i,this.border_color=r}function TextUIElement(e,t){this.font=e,this.color=t}function UIElementContainer(e){this.rect=e,this.elements=[]}function VolumeDisplay(){UIElement.call(this),this.fade_delay=0}function SplitScreenPhase(){}function Barrier(e,t,i){this.constructor(new Rectangle(Barrier.HITBOX_GAP,Barrier.HITBOX_GAP,Barrier.WIDTH-2*Barrier.HITBOX_GAP,Barrier.HEIGHT-2*Barrier.HITBOX_GAP),"barrier"),this.camera_target=!1,this.camera_number=-1,this.start_x=e,this.start_y=t,this.animation_number=i}function BonusGate(e,t){this.constructor(new Rectangle(BonusGate.HITBOX_GAP,BonusGate.HITBOX_GAP,BonusGate.WIDTH-2*BonusGate.HITBOX_GAP,BonusGate.HEIGHT-2*BonusGate.HITBOX_GAP),"bonusgate"),this.camera_target=!1,this.setCamera(1),this.start_x=e,this.start_y=t}function Debugger(){this.constructor(new Rectangle(Debugger.HITBOX_GAP,Debugger.HITBOX_GAP,Debugger.WIDTH-2*Debugger.HITBOX_GAP,Debugger.HEIGHT-2*Debugger.HITBOX_GAP),"debugger")}function GameGraphicsPhase(){}function GameRunPhase(){}function GameState(){this.score=0,this.level_number=0,this.level_progress=0,this.deaths=0,this.level_deaths=0,this.triggers=[],this.cameras=[],this.actors=[],this.effects=[],this.effect_count=0,this.current_level=null,this.new_score=!1,this.ids=0,this.player_caught=0,this.message_timer=0,this.music=null}function Glitch(e,t){this.constructor(new Rectangle(Glitch.HITBOX_GAP,Glitch.HITBOX_GAP,Glitch.WIDTH-2*Glitch.HITBOX_GAP,Glitch.HEIGHT-2*Glitch.HITBOX_GAP),"player"),this.cutscene_glitch=!1,this.start_x=e,this.start_y=t}function draw(){var e=document.getElementById("CANVAS"),t=e.getContext("2d");t.fillText("test",0,0);for(var i=[],r=0;30>r;r+=5)for(var a=0;60>a;a+=5)i.push([r,a]);for(var s=0;3>s;s++){shuffle(i);for(var r=0,a=0,o=0;o<i.length;o++){var n=i[o];t.drawImage(image,r+30*s,a,5,5,n.x,n.y,5,5),r+=5,30==r&&(r=0,a+=5)}}}function shuffle(e){for(var t,i,r=e.length;r;t=Math.floor(Math.random()*r),i=e[--r],e[r]=e[t],e[t]=i);return e}function IntroPhase(){}function JailPhase(){}function LevelNode(e,t,i){this.x=e,this.y=t,this.attributes=i}function LevelPassedPhase(){}function PausePhase(){}function Player(){var e=Player.HEIGHT-Player.HITBOX_HEIGHT,t=Player.WIDTH-Player.HITBOX_WIDTH;this.constructor(new Rectangle(t/2,e/2,Player.HITBOX_WIDTH,Player.HITBOX_HEIGHT),"player"),this.camera_target=!0,this.cutscene="intro",this.deployed=!1,this.cutscene_glitch=!1}function PlayerDiedEffect(e,t,i){this.constructor(e,t,PlayerDiedEffect.TIME),this.x=e,this.y=t,this.size=PlayerDiedEffect.SIZE,this.color=PlayerDiedEffect.COLORS[Math.floor(Math.random()*PlayerDiedEffect.COLORS.length)],this.x_velocity=PlayerDiedEffect.VELOCITY*Math.cos(i),this.y_velocity=PlayerDiedEffect.VELOCITY*Math.sin(i)}function TitlePhase(){}function Tracer(e){this.constructor(new Rectangle(Tracer.HITBOX_GAP,Tracer.HITBOX_GAP,Tracer.WIDTH-2*Tracer.HITBOX_GAP,Tracer.HEIGHT-2*Tracer.HITBOX_GAP),"tracer"),this.camera_target=!0,this.tracer_id=e,this.cutscene=!0,this.deployed=!1}function Tracerider(){this.constructor("TraceriderPreloader")}function init(){game=new Tracerider,game.init()}function TraceriderCamera(e,t){this.y=0,this.velocity=0,this.target=e,this.x=t}function TraceriderDeathCounter(){TextUIElement.call(this,"30px "+Tracerider.FONT_NAME,TraceriderUIContainer.FONT_COLOR)}function TraceriderLevel(e){this.constructor(),this.folder_name=e,this.load()}function TraceriderLevelMap(){this.levels=[new TraceriderLevel("level1"),new TraceriderLevel("level2"),new TraceriderLevel("level3"),new TraceriderLevel("level4"),new TraceriderLevel("jail"),new TraceriderLevel("win")]}function TraceriderPreloader(e,t){this.constructor(e,t)}function TraceriderUIContainer(){this.constructor(new Rectangle(0,0,game.WINDOW_WIDTH,TraceriderUIContainer.HEIGHT)),this.addUIElement(new TraceriderDeathCounter,100,15),this.addUIElement(new VolumeDisplay,(game.WINDOW_WIDTH-21*VolumeDisplay.BAR_WIDTH)/2,0)}function VolumeDisplay(){UIElement.call(this),this.fade_delay=0}function WinPhase(){}Actor.prototype.init=function(e,t,i){this.x=this.prev_x=e,this.y=this.prev_y=t,this.sprite.init(i),this.prev_frame=this.sprite.getCurrentFrame()},Actor.prototype.reset=function(){},Actor.prototype.step=function(e){this.prethink(e),this.prev_x=this.x,this.prev_y=this.y,this.prev_frame=this.sprite.getCurrentFrame(),this.preaccelerate(e),this.x_acceleration&&(this.x_velocity+=this.x_acceleration*e),this.y_acceleration&&(this.y_velocity+=this.y_acceleration*e),this.premove(e),this.x+=this.x_velocity*e,this.y+=this.y_velocity*e,this.sprite.advanceAnimation(e),this.sprite.animation_done&&this.onAnimationDone(this.sprite.current_animation.name),this.sprite.callback&&this[this.sprite.callback].call(this),this.timer>0&&(this.timer-=e,this.timer<=0&&this.timer_callback.call(this)),this.think(e)},Actor.prototype.setTimer=function(e,t){if(this.timer=e,!this[t])throw"No method found: "+t;this.timer_callback=this[t]},Actor.prototype.clearTimer=function(){this.timer=0,this.timer_callback=null},Actor.prototype.think=function(){},Actor.prototype.prethink=function(){},Actor.prototype._getInternalHitbox=function(){var e=this.sprite.getCurrentFrame().getHitbox();return null==e?this.hitbox:e},Actor.prototype.getHitbox=function(){var e=this._getInternalHitbox();return new Rectangle(this.x+e.x,this.y+e.y,e.width,e.height)},Actor.prototype.getPreviousHitbox=function(){var e=this.prev_frame.getHitbox(),t=null==e?this.hitbox:e;return new Rectangle(this.prev_x+t.x,this.prev_y+t.y,t.width,t.height)},Actor.prototype.collisionTest=function(e){if(this.getHitbox().collidesWith(e.getHitbox())){var t=this.getPreviousHitbox().getSideOf(e.getPreviousHitbox()),i=e.getPreviousHitbox().getSideOf(this.getPreviousHitbox());this.oncollide(e,t),e.oncollide(this,i)}},Actor.prototype.stopAll=function(){this.x_velocity=0,this.y_velocity=0,this.x_acceleration=0,this.y_acceleration=0},Actor.prototype.stopHorizontal=function(){this.x_velocity=0,this.x_acceleration=0},Actor.prototype.stopVertical=function(){this.y_velocity=0,this.y_acceleration=0},Actor.prototype.setVelocityByAngle=function(e,t){this.x_velocity=Math.cos(t)*e,this.y_velocity=Math.sin(t)*e},Actor.prototype.setVelocityByVector=function(e,t,i){var r=Math.sqrt(t*t+i*i);this.x_velocity=e*t/r,this.y_velocity=e*i/r},Actor.prototype.oncollide=function(){},Actor.prototype.collideStop=function(e,t,i){t.getSide(CollisionSides.sides.LEFT)?(this.x_velocity<0&&this.stopHorizontal(),this.x=e.getHitbox().right_x()-this._getInternalHitbox().x+i):t.getSide(CollisionSides.sides.RIGHT)&&(this.x_velocity>0&&this.stopHorizontal(),this.x=e.getHitbox().x-this._getInternalHitbox().right_x()-i),t.getSide(CollisionSides.sides.TOP)?(this.y_velocity<0&&this.stopVertical(),this.y=e.getHitbox().bottom_y()-this._getInternalHitbox().y+i):t.getSide(CollisionSides.sides.BOTTOM)&&(this.y_velocity>0&&this.stopVertical(),this.y=e.getHitbox().y-this._getInternalHitbox().bottom_y()-i)},Actor.prototype.collideBounce=function(e,t,i){i||(i=1);var r=e.getHitbox();t.getSide(CollisionSides.sides.TOP)?(this.y=r.bottom_y()-this.hitbox.y+.01,this.y_velocity<0&&(this.y_velocity=-this.y_velocity*i)):t.getSide(CollisionSides.sides.BOTTOM)&&(this.y=r.y-this.hitbox.bottom_y()-.01,this.y_velocity>0&&(this.y_velocity=-this.y_velocity*i)),t.getSide(CollisionSides.sides.LEFT)?(this.x=r.right_x()-this.hitbox.x+.01,this.x_velocity<0&&(this.x_velocity=-this.x_velocity*i)):t.getSide(CollisionSides.sides.RIGHT)&&(this.x=r.x-this.hitbox.right_x()-.01,this.x_velocity>0&&(this.x_velocity=-this.x_velocity*i))},Actor.prototype.getCollisionSubframeTime=function(e,t){var i,r,a,s;return t?(i=this.getHitbox().y,r=this.getPreviousHitbox().y,a=e.getHitbox().y,s=e.getHitbox().y):(i=this.getHitbox().x,r=this.getPreviousHitbox().x,a=e.getHitbox().x,s=e.getHitbox().x),i-r==a-s?0/0:(s-r)/(i-r+s-a)},Actor.prototype.getX=function(){return this.x},Actor.prototype.getY=function(){return this.y},Actor.prototype.display=function(e){this.predisplay(e),this.sprite.display(this.getX(),this.getY(),e),this.postdisplay(e)},Actor.prototype.predisplay=function(){},Actor.prototype.postdisplay=function(){},Actor.prototype.preaccelerate=function(){},Actor.prototype.premove=function(){},Actor.prototype.onAnimationDone=function(){},Animation.prototype.getFrame=function(e){return this.frames[e]},BackgroundImage.prototype.setParallax=function(e,t){null==t&&(t=e),this.x_parallax=e,this.y_parallax=t},BackgroundImage.prototype.display=function(e,t,i,r,a){for(var s=this.image.width,o=this.image.height,n=new Rectangle(this.x_parallax*game.game_engine.camera_x,this.y_parallax*game.game_engine.camera_y,i,r),h=Math.floor(n.x/s)*s,l=Math.floor(n.y/o)*o,c=Math.ceil(n.right_x()/s)*s,p=Math.ceil(n.bottom_y()/o)*o,u=h;c>u;u+=s)for(var y=Math.min(s,n.right_x()-u),g=l;p>g;g+=o){var m=Math.min(o,n.bottom_y()-g);a.drawImage(this.image,0,0,y,m,e+u-n.x,t+g-n.y,y,m)}},BackgroundImage.prototype.isLoaded=function(){return this.image.loaded},BackgroundImageMap.prototype.addBackgroundImage=function(e,t){if(this.backgrounds[e])throw"Duplicate background name:"+e;if(!t instanceof BackgroundImage)throw"background_image is not a background image";game.game_engine.preloader.registerItem(t),this.backgrounds[e]=t},BackgroundImageMap.prototype.getBackgroundImage=function(e){return this.backgrounds[e]},BackgroundImageMap.prototype.getCount=function(){return Object.keys(this.backgrounds).length},CollisionSides.sides={TOP:-2,LEFT:-1,RIGHT:1,BOTTOM:2},CollisionSides.prototype.setSide=function(e){this.collisions[e]=!0},CollisionSides.prototype.getSide=function(e){return this.collisions[e]},CollisionSides.prototype.removeSide=function(e){this.collisions[e]=!1},CollisionSides.prototype.isEmpty=function(){for(var e in this.collisions)if(1==this.collisions[e])return!1;return!0},CollisionSides.prototype.getSides=function(){var e=[];for(var t in this.collisions)1==this.collisions[t]&&e.push(t);return e},Effect.prototype.step=function(e){this.time+=e,this.time>=this.total_time?game.game_state.removeEffect(this):this.think(e)},Effect.prototype.display=function(){},SpriteEffect.prototype=Object.create(Effect.prototype),SpriteEffect.parent=Effect.prototype,SpriteEffect.prototype.think=function(e){this.sprite.advanceAnimation(e)},SpriteEffect.prototype.display=function(e){this.sprite.display(this.x,this.y,e)},Frame.prototype.getHitbox=function(){return this.hitbox};var game;Game.prototype.initGamePhases=function(){},Game.prototype.initSpriteSheets=function(){},Game.prototype.initBackgroundImages=function(){},Game.prototype.initSounds=function(){},Game.prototype.initFonts=function(){},Game.prototype.initKeys=function(){},Game.prototype.initLevelMap=function(){},Game.prototype.initTiles=function(){},Game.prototype.initUI=function(){},Game.prototype.init=function(){this.initResolution(),this.game_engine.init(this.WINDOW_WIDTH,this.WINDOW_HEIGHT,this.FRAME_RATE,this.preloader_class_name),this.initKeys(this.game_engine.key_handler),this.initSpriteSheets(),this.initTiles(),this.initBackgroundImages(),this.initSounds(),this.initFonts(),this.initLevelMap(),this.initUI(),this.initGamePhases()},Game.prototype.initResolution=function(){this.WINDOW_HEIGHT=480,this.WINDOW_WIDTH=480,this.FRAME_RATE=60,this.play_area_height=480,this.play_area_width=480},Game.prototype.playAreaHeight=function(){return this.play_area_height},Game.prototype.playAreaWidth=function(){return this.play_area_width},Game.prototype.getCurrentPhase=function(){if(null==this.current_phase)throw"Current phase has not been defined yet.";return this.current_phase},Game.prototype.initPhase=function(e){if(null!=this.current_phase)throw"initPhase should not be called more than once.";this.current_phase=this.game_phase_map.getPhase(e),this.current_phase_name=e,this.current_phase.transitionTo()},Game.prototype.transition=function(e){e!=this.current_phase_name&&(this.new_phase_name=e)},Game.prototype.transitionCheck=function(){if(null!=this.new_phase_name){var e=this.current_phase_name;this.current_phase.transitionFrom(this.new_phase_name),this.current_phase=this.game_phase_map.getPhase(this.new_phase_name),this.current_phase_name=this.new_phase_name,this.current_phase.transitionTo(e),this.new_phase_name=null}},Game.prototype.getWindow=function(){return new Rectangle(0,0,this.WINDOW_WIDTH,this.WINDOW_HEIGHT)},GameEngine.prototype.init=function(e,t,i,r){this.frame_rate=i,this.width=e,this.height=t,this.key_handler=new KeyHandler,window.addEventListener("keyup",function(e){game.game_engine.key_handler.keyUp(e)},!1),window.addEventListener("keydown",function(e){game.game_engine.key_handler.keyDown(e)},!1);var a=document.getElementsByTagName("body").item(0);a.style.margin=0;var s=document.createElement("canvas");s.height=t,s.width=e,s.id="GAME_CANVAS",a.appendChild(s);var o=document.createElement("div");o.id="fonts",a.appendChild(o),"undefined"!=typeof AudioContext?this.audio_context=new AudioContext:"undefined"!=typeof webkitAudioContext&&(this.audio_context=new webkitAudioContext),this.volume=5,this.gain_node=this.audio_context.createGain?this.audio_context.createGain():this.audio_context.createGainNode(),this.gain_node.connect(this.audio_context.destination),this.camera_x=0,this.camera_y=0,window.onload=function(){game.game_engine.fonts_loaded=!0},this.prev_time=(new Date).getTime()/1e3,this.preloader=new window[r](this.width,this.height),this.preLoad()},GameEngine.prototype.setCamera=function(e,t){this.camera_x=e,this.camera_y=t},GameEngine.prototype.getGraphicsContext=function(){return document.getElementById("GAME_CANVAS").getContext("2d")},GameEngine.prototype.getAudioContext=function(){return this.audio_context},GameEngine.prototype.playSound=function(e,t){var i=this.audio_context.createBufferSource();return i.buffer=e,i.loop=t,i.connect(this.gain_node),i.start(0),i},GameEngine.prototype.volumeUp=function(){this.volume++,this.volume>10&&(this.volume=10),this.setVolume()},GameEngine.prototype.volumeDown=function(){this.volume--,this.volume<0&&(this.volume=0),this.setVolume()},GameEngine.prototype.setVolume=function(){this.gain_node.gain.value=Math.cos(.05*(10-this.volume)*Math.PI)},GameEngine.prototype.getVolume=function(){return this.volume},GameEngine.prototype.muffleVolume=function(){this.gain_node.gain.value=Math.cos(.05*(10-this.volume/3)*Math.PI)},GameEngine.prototype.muteVolume=function(){this.gain_node.gain.value=0},GameEngine.prototype.getDelta=function(){var e=(new Date).getTime()/1e3;return delta=e-this.prev_time,this.prev_time=e,delta},GameEngine.prototype.gameLoop=function(){var e=this.getDelta(),t=game.getCurrentPhase();t.interpretInput(game.game_state,this.key_handler),this.key_handler.reset(),t.updateLogic(game.game_state,e);var i=this.getGraphicsContext();i.clearRect(0,0,this.width,this.height),t.renderGraphics(game.game_state,i),game.transitionCheck(),setTimeout(function(){game.game_engine.gameLoop()},1e3/this.frame_rate)},GameEngine.prototype.preLoad=function(){this.preloader.renderPreloader(this.getGraphicsContext()),this.preloader.isDone()&&this.fonts_loaded?(game.game_state.init(),this.gameLoop()):setTimeout(function(){game.game_engine.preLoad()},1e3/this.frame_rate)},GameEngine.prototype.initFont=function(e,t,i){var r="";"truetype"==i&&(r=" format('"+i+"')");var a=document.createElement("style");a.appendChild(document.createTextNode('	@font-face {	    font-family: "'+e+"\";	    src: url('"+t+"')"+r+";	}	")),document.head.appendChild(a);var s=document.createElement("div");s.style.fontFamily=e,s.appendChild(document.createTextNode(" ")),document.getElementById("fonts").appendChild(s)},CanvasRenderingContext2D.prototype.fillRectObject=function(e){this.fillRect(e.x,e.y,e.width,e.height)},CanvasRenderingContext2D.prototype.strokeRectObject=function(e){this.strokeRect(e.x,e.y,e.width,e.height)},CanvasRenderingContext2D.prototype.moveToPoint=function(e){this.moveTo(e[0],e[1])},CanvasRenderingContext2D.prototype.lineToPoint=function(e){this.lineTo(e[0],e[1])},GamePhase.prototype.updateLogic=function(){throw"updateLogic not defined."},GamePhase.prototype.interpretInput=function(){throw"interpretInput not defined."},GamePhase.prototype.renderGraphics=function(){throw"renderGraphics not defined."},GamePhase.prototype.transitionFrom=function(){},GamePhase.prototype.transitionTo=function(){},GamePhaseMap.prototype.addPhase=function(e,t,i){if(this.phases[e])throw"Duplicate phase name: "+e;this.phases[e]=new window[t](i)},GamePhaseMap.prototype.getPhase=function(e){if(!this.phases[e])throw"Undefined phase name: "+e;return this.phases[e]},KeyHandler.prototype.keyDown=function(e){var t;return(t=this.continuous_key_codes[e.keyCode])?(this[t]=!0,e.preventDefault(),!1):(t=this.pressed_key_codes[e.keyCode])?(this[t]=!0,e.preventDefault(),!1):!1},KeyHandler.prototype.keyUp=function(e){var t;return(t=this.continuous_key_codes[e.keyCode])?(this[t]=!1,e.preventDefault(),!1):void 0},KeyHandler.prototype.reset=function(){for(var e in this.pressed_key_codes){var t=this.pressed_key_codes[e];this[t]=!1}},KeyHandler.prototype.registerKey=function(e,t,i){i?this.continuous_key_codes[t]=e:this.pressed_key_codes[t]=e,this[e]=!1},KeyHandler.prototype.resetKeyCodes=function(){this.continuous_key_codes=new Array,this.pressed_key_codes=new Array},Level.prototype.renderBackground=function(e,t,i){t||(t=0),i||(i=0);var r=game.getWindow();this.background_image.display(r.x+t,r.y+i,r.width,r.height,e)},Level.prototype.renderGeometry=function(e,t,i){t||(t=0),i||(i=0);var r=game.getWindow();this.geometry.display(r.x+t,r.y+i,e)},Level.prototype.init=function(){this.initBackground(),this.initObjects(this.object_initializer),this.initGeometry(this.geometry_initializer)},Level.prototype.initBackground=function(){this.background_image=game.background_image_map.getBackgroundImage(this.background_image_name)},Level.prototype.initObjects=function(){throw"initObjects not defined!"},Level.prototype.initGeometry=function(){throw"initGeometry not defined!"},Level.prototype.geometryCheck=function(e){this.geometry.collisionCheck(e)},Preloader.prototype.renderPreloader=function(){},Preloader.prototype.registerItem=function(e){this.items.push(e)},Preloader.prototype.getTotalCount=function(){return this.items.length},Preloader.prototype.getLoadedCount=function(){return this.items.filter(function(e){return e.isLoaded()?!0:!1}).length},Preloader.prototype.isDone=function(){return this.getTotalCount()==this.getLoadedCount()?!0:!1},Rectangle.prototype.right_x=function(){return this.x+this.width},Rectangle.prototype.bottom_y=function(){return this.y+this.height},Rectangle.prototype.center_x=function(){return this.x+this.width/2},Rectangle.prototype.center_y=function(){return this.y+this.height/2},Rectangle.prototype.contains=function(e,t){return e>this.x&&e<this.right_x()&&t>this.y&&t<this.bottom_y()?!0:!1},Rectangle.prototype.collidesWith=function(e){return this.bottom_y()<e.y?!1:this.y>e.bottom_y()?!1:this.right_x()<e.x?!1:this.x>e.right_x()?!1:!0},Rectangle.prototype.getSideOf=function(e){var t=new CollisionSides;return e.right_x()<this.x&&t.setSide(CollisionSides.sides.LEFT),e.x>this.right_x()&&t.setSide(CollisionSides.sides.RIGHT),e.bottom_y()<this.y&&t.setSide(CollisionSides.sides.TOP),e.y>this.bottom_y()&&t.setSide(CollisionSides.sides.BOTTOM),t},SoundMap.prototype.addSound=function(e,t){if(this.sounds[e])throw"Duplicate sound name:"+e;if(!t instanceof Sound)throw"sound is not a sound";this.sounds[e]=t,game.game_engine.preloader.registerItem(t)},SoundMap.prototype.getSound=function(e){return this.sounds[e]},SoundMap.prototype.getCount=function(){return Object.keys(this.sounds).length},Sound.prototype.load=function(){var e=new XMLHttpRequest;e.open("GET","sounds/"+this.file_name,!0),e.responseType="arraybuffer",e.sound=this,e.onload=function(){var t=game.game_engine.getAudioContext();t.decodeAudioData(e.response,function(t){e.sound.buffer=t,e.sound.loaded=!0},function(){alert("Decoding the audio buffer failed")})},e.send()},Sound.prototype.handleLoad=function(e){var t=e.target,i=game.game_engine.getAudioContext();this.buffer=i.createBuffer(t.response,!0),this.loaded=!0},Sound.prototype.play=function(){this.source=game.game_engine.playSound(this.buffer,this.looping)},Sound.prototype.stop=function(){this.source&&this.source.disconnect()},Sound.prototype.isLoaded=function(){return this.loaded},Sprite.prototype.init=function(e){if(this.sprite_sheet=game.sprite_sheet_map.getSpriteSheet(this.sprite_name),e)for(var t=0;t<this.sprite_sheet.animations.length;t++)this.sprite_sheet.animations[t].name==e&&(this.current_animation=this.sprite_sheet.animations[t]);else this.current_animation=this.sprite_sheet.animations[0];this.resetAnimation()},Sprite.prototype.getAnimations=function(){return this.sprite_sheet.animations},Sprite.prototype.playAnimation=function(e){for(var t=0;t<this.sprite_sheet.animations.length;t++)if(this.sprite_sheet.animations[t].name==e)return this.current_animation=this.sprite_sheet.animations[t],void this.resetAnimation();throw"The animation name "+e+" for spritesheet "+this.sprite_sheet.file_name+" was not found."},Sprite.prototype.resetAnimation=function(){this.current_frame=0,this.frame_delta=0,this.animation_done=!1},Sprite.prototype.scale=function(e,t){t||(t=e),this.width_scaling=e,this.height_scaling=t},Sprite.prototype.display=function(e,t,i){var r=this.getCurrentFrame();if(r){var a=r.rect.x,s=r.rect.y,o=r.rect.height,n=r.rect.width,h=game.game_engine.camera_x,l=game.game_engine.camera_y;i.drawImage(this.sprite_sheet.image,a,s,n,o,Math.round(e-h),Math.round(t-l),n*this.width_scaling,o*this.height_scaling)}},Sprite.prototype.advanceAnimation=function(e){if(!this.animation_done){this.frame_delta+=e;var t=this.getCurrentFrame().duration;for(this.callback=null;this.frame_delta>t;)this.current_frame++,this.current_frame>=this.current_animation.max_frames&&(this.current_animation.continuous?this.current_frame-=this.current_animation.max_frames:(this.current_frame=this.current_animation.max_frames-1,this.animation_done=!0)),this.frame_delta-=t,t=this.getCurrentFrame().duration,this.callback=this.getCurrentFrame().callback}},Sprite.prototype.getCurrentFrame=function(){return null==this.current_animation?new Frame:this.current_animation.getFrame(this.current_frame)},SpriteSheet.prototype.addAnimation=function(e,t,i,r){"undefined"==typeof r&&(r=!0);for(var a=[],s=0;s<t.length;s++){var o=t[s],n=o.x*this.tile_width,h=o.y*this.tile_height;o.px&&(n=o.px),o.py&&(h=o.py);var l,c=o.w?o.w:this.tile_width,p=o.h?o.h:this.tile_height,u=o.t?o.t:i,y=o.c;o.hitbox&&(l=new Rectangle(o.hitbox[0],o.hitbox[1],o.hitbox[2],o.hitbox[3])),a.push(new Frame(new Rectangle(n,h,c,p),u,l,y))}this.animations.push(new Animation(e,a,r))},SpriteSheet.prototype.isLoaded=function(){return this.image.loaded},SpriteSheetMap.prototype.addSpriteSheet=function(e,t){if(this.sprite_sheets[e])throw"Duplicate spritesheet name:"+e;if(!t instanceof SpriteSheet)throw"sprite_sheet is not a sprite sheet";this.sprite_sheets[e]=t,game.game_engine.preloader.registerItem(t)},SpriteSheetMap.prototype.getSpriteSheet=function(e){return this.sprite_sheets[e]},SpriteSheetMap.prototype.getSpriteNames=function(){return Object.keys(this.sprite_sheets)},SpriteSheetMap.prototype.getCount=function(){return Object.keys(this.sprite_sheets).length},TileGeometry.SHAPES={SQUARE:0,DIAGONAL_TL:1,DIAGONAL_TR:2,DIAGONAL_BL:3,DIAGONAL_BR:4},TileGeometry.prototype._processString=function(e){var t=e.split(/\r/);this._geometry=[];for(var i=0;i<t.length;i++){var r=t[i].split(",");r.length>this.tiles_wide&&(this.tiles_wide=r.length),this._geometry.push(r)}this.tiles_high=this._geometry.length},TileGeometry.prototype.checkPixel=function(e,t){if(0>e||0>t)return null;var i=Math.floor(t/this.tile_size);if(i>=this._geometry.length)return null;var r=Math.floor(e/this.tile_size);if(r>=this._geometry[i].length)return null;var a=this.getTileAt(r,i);return null==a?null:a.shape==TileGeometry.SHAPES.SQUARE?a:a.shape==TileGeometry.SHAPES.DIAGONAL_TL||a.shape==TileGeometry.SHAPES.DIAGONAL_TR||a.shape==TileGeometry.SHAPES.DIAGONAL_BL||a.shape==TileGeometry.SHAPES.DIAGONAL_BR?this.checkDiagonalTile(a,e,t):void 0},TileGeometry.prototype.checkDiagonalTile=function(e,t,i){var r,a,s=Math.floor(i/this.tile_size),o=Math.floor(t/this.tile_size);return r=e.shape==TileGeometry.SHAPES.DIAGONAL_BL||e.shape==TileGeometry.SHAPES.DIAGONAL_TL?o*this.tile_size:(o+1)*this.tile_size,a=e.shape==TileGeometry.SHAPES.DIAGONAL_TL||e.shape==TileGeometry.SHAPES.DIAGONAL_TR?s*this.tile_size:(s+1)*this.tile_size,Math.abs(t-r)+Math.abs(i-a)<this.tile_size?e:null},TileGeometry.prototype.collisionCheck=function(e){for(var t=e.getHitbox(),i=e.getPreviousHitbox(),r=(game.game_engine.getGraphicsContext(),[]),a=t.x;a<=t.right_x()+this.tile_size;a+=5)for(var s=t.y;s<=t.bottom_y()+this.tile_size;s+=5){var o=a,n=s;if(o>t.right_x()&&(o=t.right_x()),n>t.bottom_y()&&(n=t.bottom_y()),c=this.checkPixel(o,n)){for(var h=!1,l=0;l<r.length;l++)r[l].x==c.x&&r[l].y==c.y&&(h=!0);h||r.push(c)}}for(var l=0;l<r.length;l++){var c=r[l],p=i.getSideOf(c.getHitbox());p.getSide(CollisionSides.sides.TOP)&&this.checkPixel(c.x,c.y+this.tile_size)&&p.removeSide(CollisionSides.sides.TOP),p.getSide(CollisionSides.sides.BOTTOM)&&this.checkPixel(c.x,c.y-this.tile_size)&&p.removeSide(CollisionSides.sides.BOTTOM),p.getSide(CollisionSides.sides.LEFT)&&this.checkPixel(c.x+this.tile_size,c.y)&&p.removeSide(CollisionSides.sides.LEFT),p.getSide(CollisionSides.sides.RIGHT)&&this.checkPixel(c.x-this.tile_size,c.y)&&p.removeSide(CollisionSides.sides.RIGHT),e.oncollide(c,p)}},TileGeometry.prototype.getTileAt=function(e,t){if(0>t||0>e)return null;if(t>=this._geometry.length)return null;if(e>=this._geometry[t].length)return null;var i=this._geometry[t][e];return" "==i||""==i?null:new LevelTile(e*this.tile_size,t*this.tile_size,this.tile_size,i,this.tile_set)},TileGeometry.prototype.display=function(e,t,i){for(var r=0;r<this._geometry.length;r++)for(var a=this._geometry[r],s=0;s<a.length;s++){var o=a[s];" "!=o&&""!=o&&this.tile_set.display(e+s*this.tile_size,t+r*this.tile_size,o,i)}},TileGeometry.prototype.getTileSize=function(){return this.tile_size},LevelTile.prototype=Object.create(Actor.prototype),LevelTile.parent=Actor.prototype,LevelTile.prototype.init=function(e,t){this.x=e,this.y=t},TileSet.prototype.addTileType=function(e,t,i,r,a){for(var s=[],o=0;o<r.length;o++)s[r[o]]=1;null==a&&(a=TileGeometry.SHAPES.SQUARE),this.tiles[e]={x:t*this.tile_size,y:i*this.tile_size,attributes:s,shape:a}},TileSet.prototype.isLoaded=function(){return this.image.loaded},TileSet.prototype.display=function(e,t,i,r){var a=this.tiles[i];if(!a)throw"Cannot find tile of type "+i;var s=game.game_engine.camera_x,o=game.game_engine.camera_y;r.drawImage(this.image,a.x,a.y,this.tile_size,this.tile_size,Math.round(e-s),Math.round(t-o),this.tile_size,this.tile_size)},TileSet.prototype.getCount=function(){return this.tiles.length},TileSet.prototype.getTileType=function(e){if(!this.tiles[e])throw"Unknown tile type: '"+e+"'";return this.tiles[e]},TileSetMap.prototype.addTileSet=function(e,t){if(this.tile_sets[e])throw"Duplicate tileset name:"+e;if(!t instanceof TileSet)throw"tile_set is not a tile_set";this.tile_sets[e]=t,game.game_engine.preloader.registerItem(t)},TileSetMap.prototype.getTileSet=function(e){if(!this.tile_sets[e])throw"No tile set "+e+" found.";return this.tile_sets[e]},TileSetMap.prototype.getTileSetNames=function(){return Object.keys(this.tile_sets)},TileSetMap.prototype.getCount=function(){return Object.keys(this.tile_sets).length},UIElement.prototype.getValue=function(){throw"getValue not defined.  It should return the value for the UIElement to display."},UIElement.prototype.display=function(e){this.predisplay(e),this.draw(e),this.postdisplay(e)},UIElement.prototype.draw=function(){throw"display not defined."},UIElement.prototype.setPosition=function(e,t){this.x=e,this.y=t},UIElement.prototype.step=function(){},UIElement.prototype.predisplay=function(){},UIElement.prototype.postdisplay=function(){},SpriteRepeaterUIElement.prototype=Object.create(UIElement.prototype),SpriteRepeaterUIElement.parent=UIElement.prototype,SpriteRepeaterUIElement.prototype.draw=function(e){for(var t=this.x,i=this.getValue(),r=0;i>r;r++)this.sprite.display(t,this.y,e),t+=this.sprite_width+this.padding},SpriteRepeaterUIElement.prototype.step=function(e){this.sprite.advanceAnimation(e)},MeterUIElement.prototype=Object.create(UIElement.prototype),MeterUIElement.parent=UIElement.prototype,MeterUIElement.prototype.draw=function(e){var t=this.getValue();t=Math.max(0,Math.min(t,1)),e.lineWidth=1,e.strokeStyle=this.border_color,e.strokeRect(this.x,this.y,this.width,this.height),e.fillStyle=this.color,e.fillRect(this.x+1,this.y+1,this.getValue()*(this.width-2),this.height-2)},TextUIElement.prototype=Object.create(UIElement.prototype),TextUIElement.parent=UIElement.prototype,TextUIElement.prototype.draw=function(e){e.fillStyle=this.color,e.textAlign="right",e.font=this.font,e.textBaseline="top",e.fillText(this.getValue(),this.x,this.y)
},UIElementContainer.prototype.addUIElement=function(e,t,i){if(!e instanceof UIElement)throw"Did not pass in a UIElement";e.setPosition(this.rect.x+t,this.rect.y+i),this.elements.push(e)},UIElementContainer.prototype.display=function(e){this.displayBackground(e);for(var t=0;t<this.elements.length;t++){var i=this.elements[t];i.display(e)}},UIElementContainer.prototype.step=function(e){for(var t=0;t<this.elements.length;t++)this.elements[t].step(e)},UIElementContainer.prototype.displayBackground=function(){game.game_engine.getContext().clearRect(this.rect_x,this.rect_y,this.rect.width,this.rect.height)},VolumeDisplay.prototype=Object.create(UIElement.prototype),VolumeDisplay.parent=UIElement.prototype,VolumeDisplay.RGB="0,255,0",VolumeDisplay.VISIBLE=.8,VolumeDisplay.FADEOUT=.7,VolumeDisplay.HEIGHT=32,VolumeDisplay.BAR_WIDTH=16,VolumeDisplay.prototype.step=function(e){this.fade_delay>0&&(this.fade_delay-=e,this.fade_delay<0&&(this.fade_delay=0))},VolumeDisplay.prototype.display=function(e){if(0!=this.fade_delay){var t;t=this.fade_delay>VolumeDisplay.FADEOUT?1:this.fade_delay*VolumeDisplay.FADEOUT;var i=game.game_engine.getVolume(),r=0,a="rgba("+VolumeDisplay.RGB+","+t+")";e.fillStyle=a;for(var s=0;i>s;s++)e.fillRect(this.x+r,this.y,VolumeDisplay.BAR_WIDTH,VolumeDisplay.HEIGHT),r+=2*VolumeDisplay.BAR_WIDTH}},VolumeDisplay.prototype.turnOn=function(){this.fade_delay=VolumeDisplay.VISIBLE+VolumeDisplay.FADEOUT},SplitScreenPhase.prototype=Object.create(GamePhase.prototype),SplitScreenPhase.parent=GamePhase.prototype,SplitScreenPhase.MESSAGE_TIME=5,SplitScreenPhase.MESSAGE_FADEOUT_TIME=.2,SplitScreenPhase.prototype._displayGameGraphics=function(e,t){for(var i=0;i<e.cameras.length;i++){var r=e.cameras[i];game.game_engine.setCamera(-r.x,r.y),e.current_level.renderBackground(t,r.x,0),e.current_level.renderGeometry(t,0,0),r.target.display(t);for(var a=0;a<e.actors.length;a++)(e.actors[a].getCamera()==i||-1==e.actors[a].getCamera())&&e.actors[a].display(t);if(r.target instanceof Player)for(var a=0;a<e.effects.length;a++)e.effects[a].display(t);t.lineWidth=1,t.strokeStyle="#151515",t.strokeRect(r.x,Tracerider.SPLITSCREEN_WINDOW.y,0,Tracerider.SPLITSCREEN_WINDOW.height)}if(game.ui_container.display(t),"intro"!=game.current_phase_name){var s=e.current_level.getMessage();if(s)if(e.message_timer<SplitScreenPhase.MESSAGE_TIME)this.showGlitchMessage(s,1,t);else if(e.message_timer<SplitScreenPhase.MESSAGE_TIME+SplitScreenPhase.MESSAGE_FADEOUT_TIME){var o=e.message_timer-SplitScreenPhase.MESSAGE_TIME,n=1-o/SplitScreenPhase.MESSAGE_FADEOUT_TIME;this.showGlitchMessage(s,n,t)}}},SplitScreenPhase.prototype.showGlitchMessage=function(e,t,i){var r=TraceriderUIContainer.HEIGHT+40,a=Math.floor(1*Math.random())+40;1>t&&(a+=Math.floor(1.5/t)),i.font=a+"px "+Tracerider.GLITCH_FONT_NAME,i.textAlign="center",i.textBaseline="middle",i.strokeStyle="#000000",i.lineWidth=9;for(var s=0;s<e.length;s++){var o=9*Math.random()-5,n=9*Math.random()-5;i.strokeText(e[s],game.WINDOW_WIDTH/2+o,r+n),i.fillStyle="hsla("+Math.floor(360*Math.random())+",60%,60%,"+t+")",i.fillText(e[s],game.WINDOW_WIDTH/2+o,r+n),r+=50}},Barrier.prototype=Object.create(Actor.prototype),Barrier.parent=Actor.prototype,Barrier.WIDTH=30,Barrier.HEIGHT=30,Barrier.FRAMES=6,Barrier.HITBOX_GAP=.1,Barrier.prototype.init=function(){Barrier.parent.init.call(this),this.reset()},Barrier.prototype.reset=function(){this.x=this.start_x,this.y=this.start_y,this.sprite.current_frame=this.animation_number},Barrier.prototype.setCamera=function(e){this.camera_number=e},Barrier.prototype.getCamera=function(){return this.camera_number},BonusGate.prototype=Object.create(Actor.prototype),BonusGate.parent=Actor.prototype,BonusGate.WIDTH=30,BonusGate.HEIGHT=30,BonusGate.HITBOX_GAP=.1,BonusGate.prototype.init=function(){BonusGate.parent.init.call(this),this.reset()},BonusGate.prototype.reset=function(){this.x=this.start_x,this.y=this.start_y},BonusGate.prototype.setCamera=function(e){this.camera_number=e},BonusGate.prototype.getCamera=function(){return this.camera_number},Debugger.prototype=Object.create(Actor.prototype),Debugger.parent=Actor.prototype,Debugger.WIDTH=60,Debugger.HEIGHT=60,Debugger.HITBOX_GAP=.1,Debugger.VELOCITY=100,Debugger.LOCK_TIME=.66,Debugger.CATCH_BUFFER=2,Debugger.STATES={PATROLLING:1,HOMING:2,LOCKED:3,RESETTING:4,CAUGHT:5},Debugger.prototype.init=function(){Debugger.parent.init.call(this),this.state=Debugger.STATES.PATROLLING,this.setDirection("down"),this.horiz_direction="right",this.vert_direction="up",this.target_x=0,this.target_y=0,this.x=0,this.y=game.game_state.getCameraTop(),this.lock_time=0},Debugger.prototype.think=function(e){var t=game.game_state.getPlayer();switch(t.alive&&(this.y-=game.game_state.current_level.getVelocity()*e),this.state){case Debugger.STATES.PATROLLING:"down"==this.direction&&this.y+Debugger.HEIGHT>game.game_state.getCameraBottom()&&(this.y=game.game_state.getCameraBottom()-Debugger.HEIGHT,this.setDirection(this.horiz_direction),this.vert_direction="up"),"up"==this.direction?this.y<game.game_state.getCameraTop()&&(this.y=game.game_state.getCameraTop(),this.setDirection(this.horiz_direction),this.vert_direction="down"):"left"==this.direction?Math.ceil(this.x/Debugger.WIDTH)<Math.ceil(this.prev_x/Debugger.WIDTH)&&(this.x=Math.ceil(this.x/Debugger.WIDTH)*Debugger.WIDTH,0==this.x&&(this.horiz_direction="right"),this.setDirection(this.vert_direction)):"right"==this.direction&&Math.floor(this.x/Debugger.WIDTH)>Math.floor(this.prev_x/Debugger.WIDTH)&&(this.x=Math.floor(this.x/Debugger.WIDTH)*Debugger.WIDTH,this.x==Tracerider.SPLITSCREEN_WINDOW.width-Debugger.WIDTH&&(this.horiz_direction="left"),this.setDirection(this.vert_direction)),t.glitching&&t.alive&&(this.state=Debugger.STATES.HOMING),this.lock_time-=e,this.lock_time<0&&(this.lock_time=0);break;case Debugger.STATES.HOMING:this.setVelocityByVector(Debugger.VELOCITY,t.x-this.x-(Debugger.WIDTH-Player.WIDTH)/2,t.y-this.y-(Debugger.HEIGHT-Player.HEIGHT)/2),t.glitching&&t.alive?(this.lock_time+=e,this.lock_time>Debugger.LOCK_TIME&&(this.state=Debugger.STATES.LOCKED)):this.resetPatrol();break;case Debugger.STATES.LOCKED:this.setVelocityByVector(Debugger.VELOCITY,t.x-this.x-(Debugger.WIDTH-Player.WIDTH)/2,t.y-this.y-(Debugger.HEIGHT-Player.HEIGHT)/2),t.glitching&&t.alive||this.resetPatrol();break;case Debugger.STATES.RESETTING:(this.x_velocity>0&&this.x>this.target_x||this.x_velocity<0&&this.x<this.target_x)&&(this.x=this.target_x,this.y=this.target_y,this.state=Debugger.STATES.PATROLLING,this.setDirection(this.direction)),this.lock_time-=e,this.lock_time<0&&(this.lock_time=0);break;case Debugger.STATES.CAUGHT:this.x=t.x-(Debugger.WIDTH-Player.WIDTH)/2,this.y=t.y-(Debugger.HEIGHT-Player.HEIGHT)/2}},Debugger.prototype.resetPatrol=function(){this.target_x=Math.round(this.x/Debugger.WIDTH)*Debugger.WIDTH,this.target_y=Math.round(this.y/Debugger.HEIGHT)*Debugger.HEIGHT,this.setVelocityByVector(Debugger.VELOCITY,this.target_x-this.x,this.target_y-this.y),this.state=Debugger.STATES.RESETTING},Debugger.prototype.setDirection=function(e){this.direction=e,"down"==e?(this.x_velocity=0,this.y_velocity=Debugger.VELOCITY):"up"==e?(this.x_velocity=0,this.y_velocity=-Debugger.VELOCITY):"left"==e?(this.x_velocity=-Debugger.VELOCITY,this.y_velocity=0):"right"==e&&(this.x_velocity=Debugger.VELOCITY,this.y_velocity=0)},Debugger.prototype.predisplay=function(){this.updateAnimation()},Debugger.prototype.updateAnimation=function(){var e;e=this.state==Debugger.STATES.CAUGHT?"caught":this.state==Debugger.STATES.LOCKED?"locked":this.state==Debugger.STATES.HOMING?"homing":"normal",this.sprite.current_animation.name!=e&&this.sprite.playAnimation(e)},Debugger.prototype.caughtPlayer=function(){this.state=Debugger.STATES.CAUGHT},Debugger.prototype.coordinatesForPlayer=function(){},Debugger.prototype.setCamera=function(e){this.camera=e},Debugger.prototype.getCamera=function(){return this.camera},GameGraphicsPhase.prototype=Object.create(GamePhase.prototype),GameGraphicsPhase.parent=GamePhase.prototype,GameGraphicsPhase.prototype._displayGameGraphics=function(e,t){for(e.current_level.renderBackground(t),e.current_level.renderGeometry(t),i=0;i<e.actors.length;i++)e.actors[i].display(t);for(i=0;i<e.effects.length;i++)e.effects[i].display(t)},GameRunPhase.prototype=Object.create(SplitScreenPhase.prototype),GameRunPhase.parent=SplitScreenPhase.prototype,GameRunPhase.JAIL_DELAY=3,GameRunPhase.prototype.updateLogic=function(e,t){for(var i=0;i<e.cameras.length;i++)e.cameras[i].think(t);for(e.step(t),e.geometryCollisionTest(),e.collisionTest(),i=0;i<e.effects.length;i++)e.effects[i].step(t);game.ui_container.step(t),e.getPlayer().y<-Player.HEIGHT&&game.transition("passed"),game.game_state.player_caught&&(this.jail_timer+=t,this.jail_timer>GameRunPhase.JAIL_DELAY&&game.transition("jail")),e.message_timer+=t},GameRunPhase.prototype.transitionTo=function(){this.jail_timer=0,game.game_state.player_caught=!1},GameRunPhase.prototype.interpretInput=function(e,t){if(!this.jail_timer){var i=e.getPlayer();t.LEFT_ARROW?i.move("left"):t.RIGHT_ARROW?i.move("right"):i.slowHorizontal(),t.GLITCH?i.glitchOn():i.glitchOff(),t.PAUSE&&game.transition("pause"),t.VOLUME_UP?(game.game_engine.volumeUp(),game.showVolume()):t.VOLUME_DOWN&&(game.game_engine.volumeDown(),game.showVolume())}},GameRunPhase.prototype.renderGraphics=function(e,t){this._displayGameGraphics(e,t),this.jail_timer>0&&(t.fillStyle="rgba(0,0,0,"+this.jail_timer/GameRunPhase.JAIL_DELAY+")",t.fillRect(0,0,game.WINDOW_WIDTH,game.WINDOW_HEIGHT))},GameState.prototype.init=function(){var e=new Player,t=new Tracer(0),i=new Tracer(1);this.cameras.push(new TraceriderCamera(t,0)),this.cameras.push(new TraceriderCamera(e,Tracerider.SPLITSCREEN_WINDOW.width)),this.cameras.push(new TraceriderCamera(i,2*Tracerider.SPLITSCREEN_WINDOW.width)),this.current_level=game.level_map.getLevel(this.level_number),this.current_level.init(),e.setCamera(1),this.registerActor(e),t.setCamera(0),this.registerActor(t),i.setCamera(2),this.registerActor(i),this.initLevel(),this.playMusic()},GameState.prototype.registerActor=function(e){e.init(),e.id=this.ids++,this.actors.push(e)},GameState.prototype.step=function(e){for(var t=0;t<this.actors.length;t++)this.actors[t].step(e)},GameState.prototype.collisionTest=function(){for(var e=0;e<this.actors.length;e++)for(var t=0;t<this.actors.length;t++)e!=t&&this.actors[e]&&this.actors[t]&&this.actors[e].collisionTest(this.actors[t])},GameState.prototype.geometryCollisionTest=function(){for(var e=0;e<this.actors.length;e++)this.current_level.geometry.collisionCheck(this.actors[e])},GameState.prototype.getPlayer=function(){for(var e=0;e<this.actors.length;e++)if(this.actors[e]instanceof Player)return this.actors[e]},GameState.prototype.removeActor=function(e){for(var t=0;t<this.actors.length;t++)if(this.actors[t].id==e.id)return void this.actors.splice(t,1)},GameState.prototype.addBarrier=function(e,t,i){this.registerActor(new Barrier(e,t,i))},GameState.prototype.addBonusGate=function(e,t){this.registerActor(new BonusGate(e,t))},GameState.prototype.nextLevel=function(){game.transition("run"),this.level_number++,this.level_progress++,this.level_number>=game.level_map.getLevelCount()||(this.initLevel(),this.playMusic())},GameState.prototype.setLevel=function(e){this.level_number=game.level_map.getLevelNumberByName(e),this.initLevel(),this.playMusic()},GameState.prototype.initLevel=function(){for(var e=0;e<this.actors.length;e++){var t=this.actors[e];t instanceof Player||t instanceof Tracer||(this.removeActor(t),e--)}this.current_level=game.level_map.getLevel(this.level_number),this.current_level.init();for(var e=0;e<this.actors.length;e++)this.actors[e].reset();for(var e=0;e<this.cameras.length;e++)this.cameras[e].reset();for(var e=0,i=this.current_level.getDebuggerCount();i>e;e++){var r=new Debugger;r.setCamera(1),this.registerActor(r)}this.level_deaths=0,this.message_timer=0},GameState.prototype.isLastLevel=function(){return this.level_number==TraceriderLevelMap.LEVEL_COUNT-1},GameState.prototype.stopMusic=function(){this.music&&this.music.stop()},GameState.prototype.playMusic=function(){this.music&&this.music.stop();var e;e="title"==game.current_phase_name?"title":this.current_level.getSongName(),this.music=game.sound_map.getSound(e),this.music&&this.music.play()},GameState.prototype.addDeath=function(){this.deaths++,this.level_deaths++;var e=this.getPlayer();this.addExplosion(e.x+Player.WIDTH/2,e.y+Player.HEIGHT/2)},GameState.prototype.addExplosion=function(e,t){for(var i=16,r=0;i>r;r++){var a=2*r*Math.PI/i,s=new PlayerDiedEffect(e,t,a);s.id=this.effect_count++,this.effects.push(s)}},GameState.prototype.setCameraVelocity=function(e){for(var t=0;t<this.cameras.length;t++)this.cameras[t].setVelocity(e)},GameState.prototype.reset=function(){for(var e=0;e<this.actors.length;e++)this.actors[e].reset();this.effects=[],this.effect_count=0,this.current_level=game.level_map.getLevel(this.level_number),this.current_level.init()},GameState.prototype.resumeLevelProgress=function(){this.level_number=this.level_progress,this.initLevel(),this.playMusic()},GameState.prototype.removeActorsByType=function(){},GameState.prototype.removeEffect=function(e){for(var t=0,i=this.effects.length;i>t;t++)if(this.effects[t].id==e.id)return void this.effects.splice(t,1)},GameState.prototype.getCameraTop=function(){return this.cameras[1].y+TraceriderUIContainer.HEIGHT},GameState.prototype.getCameraBottom=function(){return this.cameras[1].y+game.WINDOW_HEIGHT},GameState.prototype.playerCaught=function(){this.player_caught||(this.player_caught=!0,this.getPlayer().stopAll(),game.sound_map.getSound("caught").play())},GameState.prototype.secondsBehind=function(){for(var e,t=this.getPlayer(),i=0;i<this.actors.length;i++)if(this.actors[i]instanceof Tracer){e=this.actors[i];break}var r=t.y-e.y;return r/this.current_level.getVelocity()},GameState.prototype.isJail=function(){return this.current_level.isJail()},GameState.prototype.cutsceneEnd=function(){for(var e=0;e<this.actors.length;e++)(this.actors[e]instanceof Tracer||this.actors[e]instanceof Player)&&this.actors[e].cutsceneEnd()},GameState.prototype.getCamera=function(e){for(var t=0;t<this.cameras.length;t++)if(this.cameras[t].target==e)return this.cameras[t];return null},GameState.prototype.setupWinCutscene=function(){this.setLevel("win"),game.game_engine.setCamera(0,0);for(var e=0;e<this.actors.length;e++)this.actors[e]instanceof Player||(this.removeActor(this.actors[e]),e--);this.getPlayer().setWinCutscene();for(var e=0;e<WinPhase.GLITCH_COUNT;e++){for(var t,i,r=!1;!r;){t=Math.random()*game.WINDOW_WIDTH,i=Math.random()*game.WINDOW_HEIGHT,r=!0;for(var a=t;a<=t+Glitch.WIDTH;a+=TraceriderLevel.TILE_SIZE)for(var s=i;s<=i+Glitch.HEIGHT;s+=TraceriderLevel.TILE_SIZE)null!=this.current_level.geometry.checkPixel(a,s)&&(r=!1)}var o=new Glitch(t,i);this.registerActor(o)}},GameState.prototype.winCutsceneTransition=function(){for(var e=0;e<this.actors.length;e++)this.actors[e].winCutsceneTransition()},GameState.prototype.isWinCutsceneOver=function(){for(var e=!0,t=0;t<this.actors.length;t++)this.actors[t].isWinCutsceneOver()||(e=!1);return e},Glitch.prototype=Object.create(Actor.prototype),Glitch.parent=Actor.prototype,Glitch.WIDTH=30,Glitch.HEIGHT=60,Glitch.GLITCH_COUNT=12,Glitch.GLITCH_CHANCE=.5,Glitch.HITBOX_GAP=.1,Glitch.prototype.init=function(){Glitch.parent.init.call(this),this.reset()},Glitch.prototype.reset=function(){this.x=this.start_x,this.y=this.start_y},Glitch.prototype.winCutsceneTransition=function(){this.setTimer(WinPhase.getGlitchTime(),"cutsceneGlitch")},Glitch.prototype.cutsceneGlitch=function(){this.cutscene_glitch=!0,this.setTimer(WinPhase.MOVE_DELAY,"cutsceneMove")},Glitch.prototype.cutsceneMove=function(){this.y_velocity=WinPhase.PLAYER_VELOCITY},Glitch.prototype.isWinCutsceneOver=function(){return this.y>game.WINDOW_HEIGHT?!0:!1},Glitch.prototype.predisplay=function(){this.updateAnimation()},Glitch.prototype.updateAnimation=function(){var e;e=this.cutscene_glitch?"glitch":"normal",this.sprite.current_animation.name!=e&&this.sprite.playAnimation(e)},Glitch.prototype.postdisplay=function(e){for(var t=(game.game_state.level_progress,Glitch.GLITCH_COUNT),i=Glitch.GLITCH_CHANCE,r=0;t>r;r++)if(Math.random()<i){e.fillStyle=PlayerDiedEffect.COLORS[Math.floor(Math.random()*PlayerDiedEffect.COLORS.length)];var a=5*Math.floor(Math.random()*Player.WIDTH/5),s=5*Math.floor(Math.random()*Player.HEIGHT/5);e.fillRect(this.x+a-game.game_engine.camera_x,this.y+s-game.game_engine.camera_y,5,5)}};var image=null;window.onload=function(){image=new Image,image.width=210,image.height=120,image.addEventListener("load",draw),image.src="sprites/player.png"},IntroPhase.prototype=Object.create(SplitScreenPhase.prototype),IntroPhase.parent=SplitScreenPhase.prototype,IntroPhase.TRACER_VELOCITY=420,IntroPhase.SCRIPT_TIMER=2.2,IntroPhase.PLAY_TIMER=.5,IntroPhase.prototype.updateLogic=function(e,t){if(e.step(t),this.play_timer>=0)this.play_timer+=t,this.play_timer>IntroPhase.PLAY_TIMER&&game.transition("run");else{for(var i=!0,r=0;r<e.actors.length;r++){var a=e.actors[r];(a instanceof Player||a instanceof Tracer)&&(a.isCutsceneDone()||(i=!1))}i&&(this.play_timer=0)}if(this.timer-=t,this.timer<=0){this.timer+=IntroPhase.SCRIPT_TIMER;var s=this.instructions.shift();null!=s&&e.actors[s].introCutsceneActivate()}for(r=0;r<e.effects.length;r++)e.effects[r].step(t)},IntroPhase.prototype.interpretInput=function(){},IntroPhase.prototype.renderGraphics=function(e,t){this._displayGameGraphics(e,t)},IntroPhase.prototype.transitionTo=function(){this.timer=0,this.play_timer=-1,this.instructions=[1,2,0];for(var e=0;e<game.game_state.cameras.length;e++)game.game_state.cameras[e].reset();for(var e=0;e<game.game_state.actors.length;e++)game.game_state.actors[e].reset()},IntroPhase.prototype.transitionFrom=function(){game.game_state.cutsceneEnd(),game.game_state.playMusic()},JailPhase.prototype=Object.create(GameGraphicsPhase.prototype),JailPhase.parent=GameGraphicsPhase.prototype,JailPhase.MESSAGE_TIME=5,JailPhase.MESSAGE_FADEOUT_TIME=.2,JailPhase.prototype.updateLogic=function(e,t){var i=e.getPlayer();e.step(t),e.collisionTest(),e.geometryCollisionTest(),game.ui_container.step(t),i.getHitbox().bottom_y()<0&&game.transition("run"),(i.y>game.WINDOW_HEIGHT||i.getHitbox().right_x()<0||i.x>game.WINDOW_WIDTH)&&game.transition("win"),e.message_timer+=t},JailPhase.prototype.transitionTo=function(){for(var e=0;e<game.game_state.actors.length;e++){var t=game.game_state.actors[e];t instanceof Debugger&&(game.game_state.removeActor(t),e--)}game.game_state.setLevel("jail"),game.game_engine.setCamera(0,0);var i=game.game_state.getPlayer();i.x=game.WINDOW_WIDTH/2,i.y=game.WINDOW_HEIGHT/2},JailPhase.prototype.transitionFrom=function(e){"run"==e&&game.game_state.resumeLevelProgress()},JailPhase.prototype.interpretInput=function(e,t){var i=e.getPlayer();t.LEFT_ARROW?i.move("left"):t.RIGHT_ARROW?i.move("right"):i.slowHorizontal(),t.UP_ARROW?i.move("up"):t.DOWN_ARROW?i.move("down"):i.slowVertical(),t.GLITCH?i.glitchOn():i.glitchOff(),t.VOLUME_UP?(game.game_engine.volumeUp(),game.showVolume()):t.VOLUME_DOWN&&(game.game_engine.volumeDown(),game.showVolume())},JailPhase.prototype.renderGraphics=function(e,t){for(e.current_level.renderBackground(t),e.current_level.renderGeometry(t),i=0;i<e.actors.length;i++)e.actors[i]instanceof Tracer||e.actors[i].display(t);for(i=0;i<e.effects.length;i++)e.effects[i].display(t);var r=e.current_level.getMessage();if(r)if(e.message_timer<JailPhase.MESSAGE_TIME)this.showGlitchMessage(r,1,t);else if(e.message_timer<JailPhase.MESSAGE_TIME+JailPhase.MESSAGE_FADEOUT_TIME){var a=e.message_timer-JailPhase.MESSAGE_TIME,s=1-a/JailPhase.MESSAGE_FADEOUT_TIME;this.showGlitchMessage(r,s,t)}},JailPhase.prototype.showGlitchMessage=function(e,t,i){var r=TraceriderUIContainer.HEIGHT+40,a=Math.floor(1*Math.random())+40;1>t&&(a+=Math.floor(1.5/t)),i.font=a+"px "+Tracerider.GLITCH_FONT_NAME,i.textAlign="center",i.textBaseline="middle",i.strokeStyle="#000000",i.lineWidth=9;for(var s=0;s<e.length;s++){var o=9*Math.random()-5,n=9*Math.random()-5;i.strokeText(e[s],game.WINDOW_WIDTH/2+o,r+n),i.fillStyle="hsla("+Math.floor(360*Math.random())+",60%,60%,"+t+")",i.fillText(e[s],game.WINDOW_WIDTH/2+o,r+n),r+=50}},LevelNode.prototype.isSpin=function(){return this.attributes.spin},LevelPassedPhase.prototype=Object.create(SplitScreenPhase.prototype),LevelPassedPhase.parent=SplitScreenPhase.prototype,LevelPassedPhase.TOTAL_TIME=6,LevelPassedPhase.BEHIND_TIME=1.5,LevelPassedPhase.LEVEL_DEATHS_TIME=2.5,LevelPassedPhase.ALL_DEATHS_TIME=3.5,LevelPassedPhase.SATURATION="70%",LevelPassedPhase.VALUE="59%",LevelPassedPhase.HUE_ROTATION_TIME=2,LevelPassedPhase.prototype.transitionTo=function(){this.time=0,this.hue=0,this.last_level=!1,this.blips_played=0,game.game_state.getPlayer().stopAll(),game.sound_map.getSound("passed").play()},LevelPassedPhase.prototype.updateLogic=function(e,t){for(var i=0;i<e.cameras.length;i++)e.cameras[i].think(t);game.ui_container.step(t);for(var i=0;i<e.actors.length;i++)e.actors[i]instanceof Debugger||e.actors[i].step(t);this.time+=t,this.hue+=360*t/LevelPassedPhase.HUE_ROTATION_TIME},LevelPassedPhase.prototype.interpretInput=function(e,t){t.PAUSE&&this.time>LevelPassedPhase.TOTAL_TIME&&e.nextLevel()},LevelPassedPhase.prototype.renderGraphics=function(e,t){this._displayGameGraphics(e,t);var i=game.WINDOW_WIDTH,r=game.WINDOW_HEIGHT;t.fillStyle="rgba(0, 0, 0, .5)",t.fillRect(0,0,i,r),t.textAlign="center",t.fillStyle="hsl("+this.hue+","+LevelPassedPhase.SATURATION+","+LevelPassedPhase.VALUE+")",t.font="60pt "+Tracerider.FONT_NAME,t.fillText("Level Passed",i/2,100),t.fillStyle="#72ddca",t.font="30pt "+Tracerider.FONT_NAME,this.time>LevelPassedPhase.BEHIND_TIME&&(0==this.blips_played&&(this.blips_played++,game.sound_map.getSound("blip").play()),t.textAlign="right",t.fillText("Seconds Behind",i/2+130,200),t.textAlign="left",t.fillText(Math.round(e.secondsBehind(),2),i/2+150,200)),this.time>LevelPassedPhase.LEVEL_DEATHS_TIME&&(1==this.blips_played&&(this.blips_played++,game.sound_map.getSound("blip").play()),t.textAlign="right",t.fillText("Fails This Level",i/2+130,250),t.textAlign="left",t.fillText(e.level_deaths,i/2+150,250)),this.time>LevelPassedPhase.ALL_DEATHS_TIME&&(2==this.blips_played&&(this.blips_played++,game.sound_map.getSound("blip").play()),t.textAlign="right",t.fillText("Total Fails",i/2+130,300),t.textAlign="left",t.fillText(e.deaths,i/2+150,300)),this.time>LevelPassedPhase.TOTAL_TIME&&(t.textAlign="center",t.fillStyle="hsl(170,100%,39%)",e.isLastLevel()?(t.font="60pt "+Tracerider.FONT_NAME,t.fillText("Game Over",i/2,380)):t.fillText("Press space to continue",i/2,380))},PausePhase.prototype=Object.create(SplitScreenPhase.prototype),PausePhase.parent=SplitScreenPhase.prototype,PausePhase.prototype.updateLogic=function(e,t){game.ui_container.step(t)},PausePhase.prototype.interpretInput=function(e,t){t.PAUSE&&game.transition("run")},PausePhase.prototype.renderGraphics=function(e,t){this._displayGameGraphics(e,t);var i=game.WINDOW_WIDTH,r=game.WINDOW_HEIGHT;t.fillStyle="rgba(0, 0, 0, .7)",t.fillRect(0,0,i,r),t.textAlign="center",t.textBaseline="bottom",t.fillStyle="#72ddca",t.font="60pt "+Tracerider.FONT_NAME,t.fillText("Paused",i/2,r/2-10),t.font="30pt "+Tracerider.FONT_NAME,t.fillText("Press Space to continue",i/2,r/2+35)},PausePhase.prototype.transitionTo=function(){game.game_engine.muffleVolume()},PausePhase.prototype.transitionFrom=function(){game.game_engine.setVolume()},Player.prototype=Object.create(Actor.prototype),Player.parent=Actor.prototype,Player.MAX_VELOCITY=90,Player.ACCELERATION=300,Player.DECELERATION=700,Player.WIDTH=30,Player.HEIGHT=60,Player.HITBOX_WIDTH=10,Player.HITBOX_HEIGHT=40,Player.DEATH_TIME=2.2,Player.INVINCIBILITY_TIME=1.7,Player.SPEEDUP_TIME=.5,Player.SPEEDUP_FACTOR=4,Player.HITBOX_GAP=.1,Player.GLITCH_CHANCES=[.05,.1,.2,.6],Player.GLITCH_COUNTS=[1,2,5,15],Player.prototype.init=function(){Player.parent.init.call(this),this.reset()},Player.prototype.reset=function(){this.stopAll(),this.slowing=[!1,!1],this.glitching=!1,this.alive=!0,this.invincibility_time=0,this.speedup_time=0,this.x=(game.game_state.current_level.getWidth()-Player.WIDTH)/2,this.y=this.cutscene?game.game_state.getCamera(this).y-Player.HEIGHT:game.game_state.current_level.getHeight()+TraceriderLevel.PLAYER_START_SPACE},Player.prototype.move=function(e){this.alive&&("right"==e?(this.x_acceleration=Player.ACCELERATION,this.slowing[0]=!1):"left"==e&&(this.x_acceleration=-Player.ACCELERATION,this.slowing[0]=!1),"down"==e?(this.y_acceleration=Player.ACCELERATION,this.slowing[1]=!1):"up"==e&&(this.y_acceleration=-Player.ACCELERATION,this.slowing[1]=!1))},Player.prototype.slowHorizontal=function(){this.slowing[0]=!0,this.x_acceleration=this.x_velocity>0?-Player.DECELERATION:Player.DECELERATION},Player.prototype.slowVertical=function(){this.slowing[1]=!0,this.y_acceleration=this.y_velocity>0?-Player.DECELERATION:Player.DECELERATION},Player.prototype.glitchOn=function(){this.alive&&(this.glitching=!0)},Player.prototype.glitchOff=function(){this.alive&&(this.glitching=!1)},Player.prototype.preaccelerate=function(){this.cutscene||(this.x_velocity>Player.MAX_VELOCITY&&(this.x_velocity=Player.MAX_VELOCITY,this.x_acceleration=0),this.x_velocity<-Player.MAX_VELOCITY&&(this.x_velocity=-Player.MAX_VELOCITY,this.x_acceleration=0),this.y_velocity>Player.MAX_VELOCITY&&(this.y_velocity=Player.MAX_VELOCITY,this.y_acceleration=0),this.y_velocity<-Player.MAX_VELOCITY&&(this.y_velocity=-Player.MAX_VELOCITY,this.y_acceleration=0))},Player.prototype.premove=function(e){if(this.alive&&!this.cutscene){var t=game.game_state.current_level.getVelocity();this.isSpedUp()>0&&(t*=Player.SPEEDUP_FACTOR),this.y-=t*e}1==this.slowing[0]&&(this.x_velocity<0&&this.x_acceleration<0?(this.x_velocity=0,this.x_acceleration=0):this.x_velocity>0&&this.x_acceleration>0&&(this.x_velocity=0,this.x_acceleration=0)),1==this.slowing[1]&&(this.y_velocity<0&&this.y_acceleration<0?(this.y_velocity=0,this.y_acceleration=0):this.y_velocity>0&&this.y_acceleration>0&&(this.y_velocity=0,this.y_acceleration=0))},Player.prototype.think=function(e){"intro"==this.cutscene?this.y>=game.game_state.current_level.getHeight()+TraceriderLevel.PLAYER_START_SPACE&&(this.y=game.game_state.current_level.getHeight()+TraceriderLevel.PLAYER_START_SPACE,this.y_velocity=0):"win"==this.cutscene?this.y>=WinPhase.PLAYER_STOP_Y&&0==this.cutscene_glitch&&(this.y=WinPhase.PLAYER_STOP_Y,this.y_velocity=0):(this.invincibility_time>0&&(this.invincibility_time-=e),this.speedup_time>0&&(this.speedup_time-=e),game.game_state.isJail()||(this.x<0&&(this.x=0),this.getHitbox().right_x()>Tracerider.SPLITSCREEN_WINDOW.width&&(this.x=Tracerider.SPLITSCREEN_WINDOW.width-Player.WIDTH)))},Player.prototype.oncollide=function(e,t){if(!this.cutscene){if(e instanceof LevelTile){if(this.isInvincible())return;e.attributes.glitch&&this.glitching?this.die():e.attributes.solid&&!this.glitching?this.die():e.attributes.stops_players&&!this.glitching&&this.collideStop(e,t,Player.HITBOX_GAP)}if(e instanceof Barrier&&!this.isInvincible()&&this.die(),e instanceof Debugger&&e.state==Debugger.STATES.LOCKED){var i=e.x+(Debugger.WIDTH-Player.WIDTH)/2-this.x,r=e.y+(Debugger.HEIGHT-Player.HEIGHT)/2-this.y;Math.abs(i)<Debugger.CATCH_BUFFER&&Math.abs(r)<Debugger.CATCH_BUFFER&&(e.caughtPlayer(),game.game_state.playerCaught())}e instanceof BonusGate&&!this.glitching&&(game.game_state.removeActor(e),this.speedUp())}},Player.prototype.speedUp=function(){this.speedup_time=Player.SPEEDUP_TIME,game.sound_map.getSound("speedup").play()},Player.prototype.isSpedUp=function(){return this.speedup_time>0?!0:!1},Player.prototype.die=function(){game.sound_map.getSound("died").play(),game.game_state.addDeath(),this.stopAll(),this.alive=!1,this.setTimer(Player.DEATH_TIME,"reanimate")},Player.prototype.reanimate=function(){this.alive=!0,game.sound_map.getSound("restart").play(),this.invincibility_time=Player.INVINCIBILITY_TIME},Player.prototype.isInvincible=function(){return!this.alive||this.invincibility_time>0},Player.prototype.predisplay=function(){this.updateAnimation()},Player.prototype.updateAnimation=function(){var e;"intro"==this.cutscene?e=this.y<game.game_state.current_level.getHeight()+0+TraceriderLevel.PLAYER_START_SPACE?"introspin":this.deployed?"normal":"introdeploy":"win"==this.cutscene?e=this.cutscene_glitch?"glitch":"normal":(e=0==this.alive?"dead":this.isInvincible()?"invincible":1==this.glitching?"glitch":"normal",this.x_velocity<0&&!this.slowing[0]?e+="left":this.x_velocity>0&&!this.slowing[0]&&(e+="right")),this.sprite.current_animation.name!=e&&this.sprite.playAnimation(e)},Player.prototype.onAnimationDone=function(e){"introdeploy"==e&&(this.deployed=!0)},Player.prototype.introExplode=function(){game.sound_map.getSound("died").play(),game.game_state.addExplosion(this.x+Player.WIDTH/2,this.y+Player.HEIGHT/2)},Player.prototype.setCamera=function(e){this.camera=e},Player.prototype.getCamera=function(){return this.camera},Player.prototype.cutsceneEnd=function(){this.cutscene=!1},Player.prototype.introCutsceneActivate=function(){this.y_velocity=IntroPhase.TRACER_VELOCITY},Player.prototype.isCutsceneDone=function(){return this.deployed},Player.prototype.setWinCutscene=function(){this.cutscene="win",this.y=-Player.HEIGHT,this.x=game.WINDOW_WIDTH/2,this.stopAll(),this.y_velocity=WinPhase.PLAYER_VELOCITY},Player.prototype.winCutsceneTransition=function(){this.setTimer(WinPhase.getGlitchTime(),"cutsceneGlitch")},Player.prototype.cutsceneGlitch=function(){this.cutscene_glitch=!0,this.setTimer(WinPhase.MOVE_DELAY,"cutsceneMove")},Player.prototype.cutsceneMove=function(){this.y_velocity=WinPhase.PLAYER_VELOCITY},Player.prototype.isWinCutsceneOver=function(){return this.y>game.WINDOW_HEIGHT?!0:!1},Player.prototype.postdisplay=function(e){for(var t=game.game_state.level_progress,i=Player.GLITCH_COUNTS[t],r=Player.GLITCH_CHANCES[t],a=0;i>a;a++)if(Math.random()<r){e.fillStyle=PlayerDiedEffect.COLORS[Math.floor(Math.random()*PlayerDiedEffect.COLORS.length)];var s=5*Math.floor(Math.random()*Player.WIDTH/5),o=5*Math.floor(Math.random()*Player.HEIGHT/5);e.fillRect(this.x+s-game.game_engine.camera_x,this.y+o-game.game_engine.camera_y,5,5)}},PlayerDiedEffect.prototype=Object.create(Effect.prototype),PlayerDiedEffect.parent=Effect.prototype,PlayerDiedEffect.TIME=.5,PlayerDiedEffect.VELOCITY=90,PlayerDiedEffect.SIZE=7,PlayerDiedEffect.COLORS=["#02957c","#cd369c","#ffe685"],PlayerDiedEffect.prototype.think=function(e){this.size-=PlayerDiedEffect.SIZE*e/PlayerDiedEffect.TIME,this.x+=this.x_velocity*e,this.y+=this.y_velocity*e},PlayerDiedEffect.prototype.display=function(e){e.fillStyle=this.color,e.fillRect(this.x-game.game_engine.camera_x,this.y-game.game_engine.camera_y,this.size,this.size)},TitlePhase.prototype=Object.create(GamePhase.prototype),TitlePhase.parent=GamePhase.prototype,TitlePhase.START_DELAY=1.4,TitlePhase.START_TEXT_FLICKER_TIME=.1,TitlePhase.CIRCLE_FREQUENCY=1.5,TitlePhase.CIRCLE_VELOCITY=90,TitlePhase.CIRCLE_MIN_RADIUS=30,TitlePhase.CIRCLE_MAX_RADIUS=120,TitlePhase.prototype.updateLogic=function(e,t){game.ui_container.step(t);for(var i=0;i<this.circles.length;i++)this.circles[i].y+=t*TitlePhase.CIRCLE_VELOCITY;if(this.start_timer>=0&&(this.start_timer+=t,this.start_timer>TitlePhase.START_DELAY&&game.transition("intro")),this.circle_timer+=t,this.circle_timer>TitlePhase.CIRCLE_FREQUENCY){this.circle_timer-=TitlePhase.CIRCLE_FREQUENCY;var r=Math.random()*(TitlePhase.CIRCLE_MAX_RADIUS-TitlePhase.CIRCLE_MIN_RADIUS)+TitlePhase.CIRCLE_MIN_RADIUS;this.circles.push({x:Math.random()*(game.WINDOW_WIDTH-2*r),y:2*-r,r:r})}},TitlePhase.prototype.interpretInput=function(e,t){t.PAUSE&&(game.sound_map.getSound("passed").play(),this.start())},TitlePhase.prototype.start=function(){this.start_timer=0},TitlePhase.prototype.renderGraphics=function(e,t){t.fillStyle="#b2ece0",t.fillRect(0,0,game.WINDOW_WIDTH,game.WINDOW_HEIGHT),t.fillStyle="#2fb19c";
for(var i=0;i<this.circles.length;i++)t.beginPath(),t.arc(this.circles[i].x,this.circles[i].y,this.circles[i].r,0,2*Math.PI,!1),t.fill();t.font="90px "+Tracerider.FONT_NAME,t.textBaseline="top",t.textAlign="center",t.fillStyle="#006452",t.fillText("Tonetracers",game.WINDOW_WIDTH/2,45),t.font="45px "+Tracerider.FONT_NAME,t.fillText("2014 glitch jam",game.WINDOW_WIDTH/2,150),t.font="30px "+Tracerider.FONT_NAME,t.textAlign="left",t.fillText("mark goetz (@markdoesnttweet)",460,315),t.fillText("jake walters (@TheMcAxl)",460,360),t.fillStyle="#02957c",t.textAlign="right",t.fillText("design, programming, art",440,315),t.fillText("music",440,360),(-1==this.start_timer||this.start_timer%(2*TitlePhase.START_TEXT_FLICKER_TIME)<TitlePhase.START_TEXT_FLICKER_TIME)&&(t.font="45px "+Tracerider.FONT_NAME,t.textAlign="center",t.fillStyle="#b3027b",t.fillText("Press space to start",game.WINDOW_WIDTH/2,465))},TitlePhase.prototype.transitionTo=function(){this.circle_timer=0,this.start_timer=-1,this.circles=[]},TitlePhase.prototype.transitionFrom=function(){game.game_state.stopMusic()},Tracer.prototype=Object.create(Actor.prototype),Tracer.parent=Actor.prototype,Tracer.VELOCITY=600,Tracer.WIDTH=30,Tracer.HEIGHT=60,Tracer.DEATH_TIME=2.6,Tracer.INVINCIBILITY_TIME=1.7,Tracer.HITBOX_GAP=.1,Tracer.prototype.init=function(){Tracer.parent.init.call(this),this.reset()},Tracer.prototype.reset=function(){this.alive=!0,this.x=(game.game_state.current_level.getWidth()-Tracer.WIDTH)/2,this.cutscene?this.y=game.game_state.getCamera(this).y-Tracer.HEIGHT:(this.y=game.game_state.current_level.getHeight()+TraceriderLevel.PLAYER_START_SPACE,this.getNode())},Tracer.prototype.getNode=function(){if(this.stopAll(),this.node=game.game_state.current_level.getNode(this.y,this.tracer_id),null!=this.node){var e=0;this.node.x<this.x?e=-1:this.node.x>this.x&&(e=1);var t;if(this.node.isSpin()){var i=(this.y-this.node.y)/game.game_state.current_level.getVelocity();t=Math.abs(this.node.x-this.x)/i}else t=Tracer.VELOCITY;this.x_velocity=e*t}},Tracer.prototype.think=function(){if(this.cutscene)this.y>=game.game_state.current_level.getHeight()+0+TraceriderLevel.PLAYER_START_SPACE&&(this.y=game.game_state.current_level.getHeight()+0+TraceriderLevel.PLAYER_START_SPACE,this.y_velocity=0);else{if(!this.node)return;if(this.y<this.node.y&&this.getNode(),!this.node)return;(this.x>=this.node.x&&this.x_velocity>0||this.x<=this.node.x&&this.x_velocity<0)&&(this.x=this.node.x,this.x_velocity=0)}},Tracer.prototype.premove=function(e){this.cutscene||(this.y-=game.game_state.current_level.getVelocity()*e)},Tracer.prototype.predisplay=function(){this.updateAnimation()},Tracer.prototype.updateAnimation=function(){var e;e=this.cutscene?this.y<game.game_state.current_level.getHeight()+0+TraceriderLevel.PLAYER_START_SPACE?"introspin":this.deployed?"normal":"introdeploy":this.x_velocity<0?this.node&&this.node.isSpin()?"spinleft":"moveleft":this.x_velocity>0?this.node&&this.node.isSpin()?"spinright":"moveright":"normal",this.sprite.current_animation.name!=e&&this.sprite.playAnimation(e)},Tracer.prototype.onAnimationDone=function(e){"introdeploy"==e&&(this.deployed=!0)},Tracer.prototype.setCamera=function(e){this.camera=e},Tracer.prototype.getCamera=function(){return this.camera},Tracer.prototype.cutsceneEnd=function(){this.cutscene=!1,this.getNode()},Tracer.prototype.introCutsceneActivate=function(){this.y_velocity=IntroPhase.TRACER_VELOCITY},Tracer.prototype.isCutsceneDone=function(){return this.deployed},Tracer.prototype.introTurnOnEffect=function(){game.sound_map.getSound("blip").play()},Tracerider.prototype=Object.create(Game.prototype),Tracerider.parent=Game.prototype,Tracerider.FONT_NAME="Questrial",Tracerider.GLITCH_FONT_NAME="Pixel",Tracerider.SPLITSCREEN_WINDOW=new Rectangle(0,0,300,600),Tracerider.prototype.initResolution=function(){this.WINDOW_HEIGHT=600,this.WINDOW_WIDTH=900,this.FRAME_RATE=60,this.play_area_width=this.WINDOW_WIDTH,this.play_area_height=this.WINDOW_HEIGHT},Tracerider.prototype.initLevelMap=function(){this.level_map=new TraceriderLevelMap},Tracerider.prototype.initUI=function(){this.ui_container=new TraceriderUIContainer},Tracerider.prototype.initGamePhases=function(){this.game_phase_map.addPhase("run","GameRunPhase",["pause","jail","passed"]),this.game_phase_map.addPhase("pause","PausePhase",["run"]),this.game_phase_map.addPhase("title","TitlePhase",["intro"]),this.game_phase_map.addPhase("intro","IntroPhase",["run"]),this.game_phase_map.addPhase("passed","LevelPassedPhase",["run"]),this.game_phase_map.addPhase("jail","JailPhase",["run"]),this.game_phase_map.addPhase("win","WinPhase",["title"]),this.initPhase("title")},Tracerider.prototype.initSpriteSheets=function(){var e=new SpriteSheet("player.png",Player.WIDTH,Player.HEIGHT);e.addAnimation("normal",[{x:0,y:0},{x:1,y:0}],.2),e.addAnimation("normalleft",[{x:2,y:0},{x:3,y:0}],.2),e.addAnimation("normalright",[{x:4,y:0},{x:5,y:0}],.2),e.addAnimation("glitch",[{x:8,y:1},{x:9,y:1},{x:10,y:1}],1/8),e.addAnimation("glitchleft",[{x:8,y:1},{x:9,y:1},{x:10,y:1}],1/8),e.addAnimation("glitchright",[{x:8,y:1},{x:9,y:1},{x:10,y:1}],1/8),e.addAnimation("dead",[{x:6,y:0},{x:7,y:0}],.1),e.addAnimation("invincible",[{x:8,y:0},{x:0,y:0}],1/6),e.addAnimation("invincibleleft",[{x:9,y:0},{x:2,y:0}],1/6),e.addAnimation("invincibleright",[{x:10,y:0},{x:4,y:0}],1/6),e.addAnimation("introspin",[{x:0,y:1},{x:1,y:1},{x:2,y:1},{x:3,y:1},{x:4,y:1},{x:5,y:1}],.1),e.addAnimation("introdeploy",[{x:0,y:1,t:.5},{x:6,y:1,c:"introExplode"},{x:7,y:1},{x:0,y:0}],.1,!1),this.sprite_sheet_map.addSpriteSheet("player",e);var t=new SpriteSheet("tracer.png",Tracer.WIDTH,Tracer.HEIGHT);t.addAnimation("normal",[{x:0,y:0}],1/8),t.addAnimation("moveleft",[{x:1,y:0}],1),t.addAnimation("moveright",[{x:2,y:0}],1),t.addAnimation("spinleft",[{x:1,y:0},{x:3,y:0},{x:5,y:0},{x:4,y:0},{x:2,y:0},{x:0,y:0}],.1),t.addAnimation("spinright",[{x:2,y:0},{x:4,y:0},{x:5,y:0},{x:3,y:0},{x:1,y:0},{x:0,y:0}],.1),t.addAnimation("introspin",[{x:0,y:1},{x:1,y:1},{x:2,y:1},{x:3,y:1},{x:4,y:1},{x:5,y:1}],.1),t.addAnimation("introdeploy",[{x:0,y:1,t:.5},{x:6,y:0,c:"introTurnOnEffect"},{x:6,y:1},{x:0,y:0,t:1}],.1,!1),this.sprite_sheet_map.addSpriteSheet("tracer",t);var i=new SpriteSheet("debugger.png",Debugger.WIDTH,Debugger.HEIGHT);i.addAnimation("normal",[{x:0,y:0},{x:1,y:0},{x:2,y:0},{x:3,y:0}],.2),i.addAnimation("homing",[{x:0,y:1},{x:1,y:1},{x:2,y:1},{x:3,y:1}],.1),i.addAnimation("locked",[{x:0,y:2},{x:1,y:2},{x:2,y:2},{x:3,y:2}],1/6),i.addAnimation("caught",[{x:0,y:3},{x:1,y:3}],.25),this.sprite_sheet_map.addSpriteSheet("debugger",i);var r=new SpriteSheet("barrier.png",Barrier.WIDTH,Barrier.HEIGHT);r.addAnimation("normal",[{x:0,y:0},{x:1,y:0},{x:2,y:0},{x:3,y:0},{x:4,y:0},{x:5,y:0}],1/8),this.sprite_sheet_map.addSpriteSheet("barrier",r);var a=new SpriteSheet("bonusgate.png",BonusGate.WIDTH,BonusGate.HEIGHT);a.addAnimation("static",[{x:0,y:0},{x:1,y:0},{x:2,y:0},{x:0,y:1},{x:1,y:1},{x:2,y:1}],.09),this.sprite_sheet_map.addSpriteSheet("bonusgate",a)},Tracerider.prototype.initTiles=function(){for(var e=["red","purple","blue","black"],t=0;t<e.length;t++){var i=e[t],r=new TileSet(i+".png",TraceriderLevel.TILE_SIZE);r.addTileType("0",0,0,["solid"]),r.addTileType("g",1,0,["glitch"]),r.addTileType("n",2,0,["node1","node2"]),r.addTileType("n1",2,0,["node1"]),r.addTileType("n2",2,0,["node2"]),r.addTileType("s",2,0,["node1","node2","spin"]),r.addTileType("s1",2,0,["node1","spin"]),r.addTileType("s2",2,0,["node2","spin"]),r.addTileType("_",2,0,["barrier"]),r.addTileType("o",2,0,["bonusgate"]),r.addTileType("b",0,1,["solid"],TileGeometry.SHAPES.DIAGONAL_BL),r.addTileType("d",1,1,["solid"],TileGeometry.SHAPES.DIAGONAL_BR),r.addTileType("p",3,1,["solid"],TileGeometry.SHAPES.DIAGONAL_TL),r.addTileType("q",2,1,["solid"],TileGeometry.SHAPES.DIAGONAL_TR),this.tile_map.addTileSet(i,r)}var a=new TileSet("jail.png",TraceriderLevel.TILE_SIZE);a.addTileType("0",0,0,["stops_players"]),a.addTileType("n",1,0,["node1","node2"]),a.addTileType("=",1,0,["barrier"]),this.tile_map.addTileSet("jail",a)},Tracerider.prototype.initBackgroundImages=function(){this.background_image_map.addBackgroundImage("red",new BackgroundImage("red.png")),this.background_image_map.addBackgroundImage("blue",new BackgroundImage("blue.png")),this.background_image_map.addBackgroundImage("purple",new BackgroundImage("purple.png")),this.background_image_map.addBackgroundImage("black",new BackgroundImage("black.png")),this.background_image_map.addBackgroundImage("jail",new BackgroundImage("jail.png"))},Tracerider.prototype.initFonts=function(){this.game_engine.initFont(Tracerider.FONT_NAME,"Questrial-Regular.otf","otf"),this.game_engine.initFont(Tracerider.GLITCH_FONT_NAME,"pixel.ttf","ttf")},Tracerider.prototype.initKeys=function(){this.game_engine.key_handler.registerKey("LEFT_ARROW",37,!0),this.game_engine.key_handler.registerKey("RIGHT_ARROW",39,!0),this.game_engine.key_handler.registerKey("UP_ARROW",38,!0),this.game_engine.key_handler.registerKey("DOWN_ARROW",40,!0),this.game_engine.key_handler.registerKey("GLITCH",16,!0),this.game_engine.key_handler.registerKey("PAUSE",32,!1),this.game_engine.key_handler.registerKey("VOLUME_UP",187,!1),this.game_engine.key_handler.registerKey("VOLUME_DOWN",189,!1)},Tracerider.prototype.initSounds=function(){this.sound_map.addSound("song1",new Sound("Game_Jam_Song_1.mp3",!0)),this.sound_map.addSound("jail",new Sound("Prison_Theme_V2.mp3",!0)),this.sound_map.addSound("title",new Sound("Game_Jam_Title.mp3",!0)),this.sound_map.addSound("died",new Sound("died.wav",!1)),this.sound_map.addSound("blip",new Sound("blip.wav",!1)),this.sound_map.addSound("caught",new Sound("caught.wav",!1)),this.sound_map.addSound("glitch",new Sound("glitch.wav",!1)),this.sound_map.addSound("passed",new Sound("passed.wav",!1)),this.sound_map.addSound("restart",new Sound("restart.wav",!1)),this.sound_map.addSound("speedup",new Sound("speedup.wav",!1))},Tracerider.prototype.showVolume=function(){this.ui_container.showVolume()},Tracerider.prototype.getWindow=function(){return"jail"==this.current_phase_name||"win"==this.current_phase_name||"title"==this.current_phase_name?Tracerider.parent.getWindow.call(this):Tracerider.SPLITSCREEN_WINDOW},TraceriderCamera.SPACE_AHEAD=420,TraceriderCamera.prototype.think=function(e){if(this.target.alive&&!this.target.cutscene){var t=this.velocity;this.target instanceof Player&&this.target.isSpedUp()&&(t*=Player.SPEEDUP_FACTOR),this.y-=t*e,game.game_engine.setCamera(-this.x,this.y)}},TraceriderCamera.prototype.reset=function(){this.y=this.target.cutscene?game.game_state.current_level.getHeight()+TraceriderLevel.PLAYER_START_SPACE-TraceriderCamera.SPACE_AHEAD:this.target.y-TraceriderCamera.SPACE_AHEAD-TraceriderUIContainer.HEIGHT,game.game_engine.setCamera(-this.x,this.y)},TraceriderCamera.prototype.setVelocity=function(e){this.velocity=e},TraceriderDeathCounter.prototype=Object.create(TextUIElement.prototype),TraceriderDeathCounter.parent=TextUIElement.prototype,TraceriderDeathCounter.prototype.getValue=function(){return game.game_state.level_deaths},TraceriderLevel.prototype=Object.create(Level.prototype),TraceriderLevel.parent=Level.prototype,TraceriderLevel.TILE_SIZE=30,TraceriderLevel.PLAYER_START_SPACE=600,TraceriderLevel.PARALLAX=.5,TraceriderLevel.prototype.initObjects=function(){this.palette=this.object_initializer.palette,this.background_image_name=this.object_initializer.palette,this.initBackground(),this.background_image.setParallax(0,TraceriderLevel.PARALLAX),this.width=this.object_initializer.width,game.game_state.setCameraVelocity(this.object_initializer.velocity)},TraceriderLevel.prototype.initGeometry=function(){this.geometry=new TileGeometry(TraceriderLevel.TILE_SIZE,this.geometry_initializer,this.palette),this.initNodes()},TraceriderLevel.prototype.initNodes=function(){this.nodes=[];for(var e=0,t=0;t<this.geometry.tiles_high;t++)for(var i=0;i<this.geometry.tiles_wide;i++){var r=this.geometry.getTileAt(i,t);null!=r&&((r.attributes.node1||r.attributes.node2)&&this.nodes.push(new LevelNode(i*TraceriderLevel.TILE_SIZE,t*TraceriderLevel.TILE_SIZE,r.attributes)),r.attributes.barrier?(game.game_state.addBarrier(i*TraceriderLevel.TILE_SIZE,t*TraceriderLevel.TILE_SIZE,e),e++,e==Barrier.FRAMES&&(e=0)):e=0,r.attributes.bonusgate&&game.game_state.addBonusGate(i*TraceriderLevel.TILE_SIZE,t*TraceriderLevel.TILE_SIZE))}},TraceriderLevel.prototype.getNode=function(e,t){for(var i=null,r=0;r<this.nodes.length;r++){var a=this.nodes[r];a.y>e||null!=i&&a.y<i.y||(0==t&&a.attributes.node1&&(i=a),1==t&&a.attributes.node2&&(i=a))}return i},TraceriderLevel.prototype.load=function(){var geometry_xhr=new XMLHttpRequest;geometry_xhr.open("GET","levels/"+this.folder_name+"/geometry.csv",!0),geometry_xhr.level=this,geometry_xhr.responseType="text",geometry_xhr.onload=function(){this.level.geometry_initializer=this.responseText},geometry_xhr.send();var objects_xhr=new XMLHttpRequest;objects_xhr.open("GET","levels/"+this.folder_name+"/objects.txt",!0),objects_xhr.level=this,objects_xhr.responseType="text",objects_xhr.onload=function(){this.level.object_initializer=eval("("+this.response+")")},objects_xhr.send()},TraceriderLevel.prototype.isLoaded=function(){return this.object_initializer&&this.geometry_initializer},TraceriderLevel.prototype.getHeight=function(){return TraceriderLevel.TILE_SIZE*this.geometry.tiles_high},TraceriderLevel.prototype.getWidth=function(){return TraceriderLevel.TILE_SIZE*this.geometry.tiles_wide},TraceriderLevel.prototype.getVelocity=function(){return this.object_initializer.velocity?this.object_initializer.velocity:0},TraceriderLevel.prototype.isJail=function(){return this.object_initializer.is_jail?this.object_initializer.is_jail:!1},TraceriderLevel.prototype.getDebuggerCount=function(){return this.object_initializer.debuggers?this.object_initializer.debuggers:0},TraceriderLevel.prototype.getMessage=function(){return this.object_initializer.message?this.object_initializer.message:!1},TraceriderLevel.prototype.getSongName=function(){return this.object_initializer.song?this.object_initializer.song:!1},TraceriderLevelMap.LEVEL_COUNT=4,TraceriderLevelMap.prototype.getLevel=function(e){return this.levels[e]},TraceriderLevelMap.prototype.getLevelCount=function(){return this.levels.count},TraceriderLevelMap.prototype.getLevelNumberByName=function(e){for(var t=0;t<this.levels.length;t++)if(this.levels[t].folder_name==e)return t;return null},TraceriderPreloader.prototype=Object.create(Preloader.prototype),TraceriderPreloader.parent=Preloader.prototype,TraceriderPreloader.prototype.renderPreloader=function(e){var t=this.getLoadedCount(),i=this.getTotalCount(),r=15,a=this.width-30,s=15,o=(this.height-r)/2;e.strokeStyle="#006452",e.lineWidth=.5,e.strokeRect(s,o,a,r),e.fillStyle="#72ddca",e.fillRect(s,o,a*(t/i),r)},TraceriderUIContainer.prototype=Object.create(UIElementContainer.prototype),TraceriderUIContainer.parent=UIElementContainer.prototype,TraceriderUIContainer.HEIGHT=60,TraceriderUIContainer.BACKGROUND_COLOR="#001f1a",TraceriderUIContainer.FONT_COLOR="#ffe785",TraceriderUIContainer.prototype.displayBackground=function(e){e.fillStyle=TraceriderUIContainer.BACKGROUND_COLOR,e.fillRect(this.rect.x,this.rect.y,this.rect.width,this.rect.height),e.fillStyle=TraceriderUIContainer.FONT_COLOR,e.font="30px "+Tracerider.FONT_NAME,e.textAlign="left",e.textBaseline="top",e.fillText("fails:",15,15)},TraceriderUIContainer.prototype.showVolume=function(){this.elements[0].turnOn()},VolumeDisplay.prototype=Object.create(UIElement.prototype),VolumeDisplay.parent=UIElement.prototype,VolumeDisplay.RGB="0,255,0",VolumeDisplay.VISIBLE=.8,VolumeDisplay.FADEOUT=.7,VolumeDisplay.HEIGHT=32,VolumeDisplay.BAR_WIDTH=16,VolumeDisplay.prototype.step=function(e){this.fade_delay>0&&(this.fade_delay-=e,this.fade_delay<0&&(this.fade_delay=0))},VolumeDisplay.prototype.display=function(e){if(0!=this.fade_delay){var t;t=this.fade_delay>VolumeDisplay.FADEOUT?1:this.fade_delay*VolumeDisplay.FADEOUT;var i=game.game_engine.getVolume(),r=0,a="rgba("+VolumeDisplay.RGB+","+t+")";e.fillStyle=a;for(var s=0;i>s;s++)e.fillRect(this.x+r,this.y,VolumeDisplay.BAR_WIDTH,VolumeDisplay.HEIGHT),r+=2*VolumeDisplay.BAR_WIDTH}},VolumeDisplay.prototype.turnOn=function(){this.fade_delay=VolumeDisplay.VISIBLE+VolumeDisplay.FADEOUT},WinPhase.prototype=Object.create(GameGraphicsPhase.prototype),WinPhase.parent=GameGraphicsPhase.prototype,WinPhase.MESSAGE_FADEIN_TIME=3,WinPhase.MIN_GLITCH_DELAY=2.5,WinPhase.MAX_GLITCH_DELAY=4,WinPhase.MOVE_DELAY=2,WinPhase.PLAYER_VELOCITY=150,WinPhase.PLAYER_STOP_Y=300,WinPhase.GLITCH_COUNT=10,WinPhase.GLITCH_FADEIN_TIME=5,WinPhase.getGlitchTime=function(){return Math.random()*(WinPhase.MAX_GLITCH_DELAY-WinPhase.MIN_GLITCH_DELAY)+WinPhase.MIN_GLITCH_DELAY},WinPhase.prototype.updateLogic=function(e,t){game.ui_container.step(t),e.step(t),this.show_message_timer>=0&&(this.show_message_timer=Math.min(this.show_message_timer+t,WinPhase.MESSAGE_FADEIN_TIME)),this.fadein_timer<WinPhase.GLITCH_FADEIN_TIME&&(this.fadein_timer+=t,this.fadein_timer>=WinPhase.GLITCH_FADEIN_TIME&&(this.fadein_timer=WinPhase.GLITCH_FADEIN_TIME)),0==e.getPlayer().y_velocity&&0==this.transitioned&&(e.winCutsceneTransition(),this.transitioned=!0),e.isWinCutsceneOver()&&-1==this.show_message_timer&&(this.show_message_timer=0)},WinPhase.prototype.interpretInput=function(){},WinPhase.prototype.renderGraphics=function(e,t){for(e.current_level.renderBackground(t),e.current_level.renderGeometry(t),i=0;i<e.actors.length;i++)t.globalAlpha=e.actors[i]instanceof Glitch?this.fadein_timer/WinPhase.GLITCH_FADEIN_TIME:1,e.actors[i].display(t);for(t.globalAlpha=1,i=0;i<e.effects.length;i++)e.effects[i].display(t);if(this.show_message_timer>=0){var r=this.show_message_timer/WinPhase.MESSAGE_FADEIN_TIME;t.fillStyle="hsla(170,100%,39%,"+r+")",t.textAlign="center",t.font="90px "+Tracerider.FONT_NAME,t.fillText("You Won",game.WINDOW_WIDTH/2,200)}},WinPhase.prototype.transitionTo=function(){game.game_state.setupWinCutscene(),this.show_message_timer=-1,this.fadein_timer=0,this.transitioned=!1};